//
// AUTO-GENERATED FILE, DO NOT MODIFY!
//

import 'dart:async';
import 'dart:convert';
import 'package:dio/dio.dart';
import 'package:{{pubName}}/src/serializers.dart';
import 'package:built_collection/built_collection.dart';
import 'package:built_value/serializer.dart';

// Import ResponseWrapper from common_lib
import 'package:common/model/response_wrapper.dart';

// Standard imports needed by all APIs
import 'package:{{pubName}}/src/api_util.dart';

{{! Import model classes used in this API (clean, deduped if available; otherwise fall back to default imports) }}
{{#hasImportsClean}}
  {{#importsClean}}
import '{{.}}';
  {{/importsClean}}
{{/hasImportsClean}}
{{^hasImportsClean}}
  {{#imports}}
    {{#import}}import '{{import}}';{{/import}}
    {{^import}}import '{{.}}';{{/import}}
  {{/imports}}
{{/hasImportsClean}}

class {{classname}} {
  const {{classname}}(this._dio, this._serializers);

  final Dio _dio;
  final Serializers _serializers;

{{#operations}}
{{#operation}}
  /// {{summary}}
  {{#notes}}
  /// {{&notes}}
  {{/notes}}
  Future<Response<{{#returnType}}{{#vendorExtensions.x-generic-type}}ResponseWrapper<{{#vendorExtensions.x-wrapper-type-is-list}}{{#vendorExtensions.x-generic-is-primitive}}List<{{vendorExtensions.x-generic-dart-type}}>{{/vendorExtensions.x-generic-is-primitive}}{{^vendorExtensions.x-generic-is-primitive}}List<{{vendorExtensions.x-generic-type}}>{{/vendorExtensions.x-generic-is-primitive}}{{/vendorExtensions.x-wrapper-type-is-list}}{{#vendorExtensions.x-wrapper-type-is-page}}{{#vendorExtensions.x-generic-is-primitive}}List<{{vendorExtensions.x-generic-dart-type}}>{{/vendorExtensions.x-generic-is-primitive}}{{^vendorExtensions.x-generic-is-primitive}}List<{{vendorExtensions.x-generic-type}}>{{/vendorExtensions.x-generic-is-primitive}}{{/vendorExtensions.x-wrapper-type-is-page}}{{^vendorExtensions.x-wrapper-type-is-list}}{{^vendorExtensions.x-wrapper-type-is-page}}{{#vendorExtensions.x-generic-is-primitive}}{{vendorExtensions.x-generic-dart-type}}{{/vendorExtensions.x-generic-is-primitive}}{{^vendorExtensions.x-generic-is-primitive}}{{vendorExtensions.x-generic-type}}{{/vendorExtensions.x-generic-is-primitive}}{{/vendorExtensions.x-wrapper-type-is-page}}{{/vendorExtensions.x-wrapper-type-is-list}}>{{/vendorExtensions.x-generic-type}}{{^vendorExtensions.x-generic-type}}{{&dataType}}{{/vendorExtensions.x-generic-type}}{{/returnType}}{{^returnType}}void{{/returnType}}>> {{operationId}}({{#hasParams}}{
    {{#allParams}}{{#required}}required {{/required}}{{{dataType}}}{{^required}}?{{/required}} {{paramName}},
    {{/allParams}}
  }{{/hasParams}}) async {
    const _extra = <String, dynamic>{};
    final queryParameters = <String, dynamic>{};
    {{#queryParams}}
    {{^required}}
    if ({{paramName}} != null) {
    {{/required}}
    queryParameters[r'{{baseName}}'] = {{paramName}};
    {{^required}}
    }
    {{/required}}
    {{/queryParams}}
    final _headers = <String, dynamic>{};
    {{#headerParams}}
    {{^required}}
    if ({{paramName}} != null) {
    {{/required}}
    _headers[r'{{baseName}}'] = {{paramName}};
    {{^required}}
    }
    {{/required}}
    {{/headerParams}}
    {{#hasBodyParam}}
  dynamic _data;
  {{#hasBodyParam}}
  _data = {{#bodyParam}}{{paramName}}{{/bodyParam}};
  {{/hasBodyParam}}
    {{/hasBodyParam}}
    {{^hasBodyParam}}
    {{#hasFormParams}}
    final _data = <String, dynamic>{};
    {{#formParams}}
    {{^required}}
    if ({{paramName}} != null) {
    {{/required}}
    _data[r'{{baseName}}'] = {{paramName}};
    {{^required}}
    }
    {{/required}}
    {{/formParams}}
    {{/hasFormParams}}
    {{^hasFormParams}}
    const Map<String, dynamic>? _data = null;
    {{/hasFormParams}}
    {{/hasBodyParam}}
  final _result = await _dio.fetch<{{#returnType}}Map<String, dynamic>{{/returnType}}{{^returnType}}void{{/returnType}}>(Options(
      method: '{{httpMethod}}',
      headers: _headers,
      extra: _extra,
    )
        .compose(
          _dio.options,
          '{{&path}}'{{#pathParams}}.replaceAll('{' '{{{baseName}}}' '}', {{{paramName}}}.toString()){{/pathParams}},
          queryParameters: queryParameters,
          data: _data,
        )
        .copyWith(
            baseUrl: _combineBaseUrls(
          _dio.options.baseUrl,
          null,
        )));
    {{#returnType}}
    {{#vendorExtensions.x-generic-type}}
    final _json = _result.data!;

    {{!-- SINGLE --}}
    {{#vendorExtensions.x-wrapper-type-is-single}}
    {{#vendorExtensions.x-generic-is-primitive}}
    // Using universal deserialization for primitive types
    final value = ResponseWrapper<{{vendorExtensions.x-generic-dart-type}}>.fromJsonSafe(
      _result.data!,
      (json) => json as {{vendorExtensions.x-generic-dart-type}},
    );
    {{/vendorExtensions.x-generic-is-primitive}}
    {{^vendorExtensions.x-generic-is-primitive}}
    // Using universal deserialization for complex types
    final value = ResponseWrapper<{{vendorExtensions.x-generic-type}}>.fromJsonSafe(
      _result.data!,
      (json) => _serializers.deserializeWith(
        {{vendorExtensions.x-generic-type}}.serializer,
        (json as Map<String, dynamic>).map((k, v) => MapEntry(k, v)),
      )!,
    );
    {{/vendorExtensions.x-generic-is-primitive}}

    return Response<ResponseWrapper<{{#vendorExtensions.x-generic-is-primitive}}{{vendorExtensions.x-generic-dart-type}}{{/vendorExtensions.x-generic-is-primitive}}{{^vendorExtensions.x-generic-is-primitive}}{{vendorExtensions.x-generic-type}}{{/vendorExtensions.x-generic-is-primitive}}>>(
      statusCode: _result.statusCode,
      data: value,
      headers: _result.headers,
      isRedirect: _result.isRedirect,
      requestOptions: _result.requestOptions,
      redirects: _result.redirects,
      extra: _result.extra,
    );
    {{/vendorExtensions.x-wrapper-type-is-single}}

    {{!-- LIST --}}
    {{#vendorExtensions.x-wrapper-type-is-list}}
      {{#vendorExtensions.x-generic-is-primitive}}
  {{#vendorExtensions.x-generic-dart-type}}
  final _dataVal = (_json['data'] as List<dynamic>).map((e) => _convertPrimitiveByName('{{vendorExtensions.x-generic-dart-type}}', e) as {{vendorExtensions.x-generic-dart-type}}).toList();
  {{/vendorExtensions.x-generic-dart-type}}
  {{^vendorExtensions.x-generic-dart-type}}
  final _dataVal = (_json['data'] as List<dynamic>).map((e) => e).toList();
  {{/vendorExtensions.x-generic-dart-type}}
      {{/vendorExtensions.x-generic-is-primitive}}
      {{^vendorExtensions.x-generic-is-primitive}}
    final _dataVal = (_json['data'] as List<dynamic>)
      .map((e) => _serializers.deserializeWith(
        {{vendorExtensions.x-generic-type}}.serializer,
        (e as Map<String, dynamic>).map((k, v) => MapEntry(k, v)),
      )!)
      .toList();
      {{/vendorExtensions.x-generic-is-primitive}}

      {{#vendorExtensions.x-metadata-type}}
    final _metadataVal = _json['metadata'] == null
      ? null
      : _serializers.deserializeWith(
          {{vendorExtensions.x-metadata-type}}.serializer,
          (_json['metadata'] as Map<String, dynamic>).map((k, v) => MapEntry(k, v)),
        );
      {{/vendorExtensions.x-metadata-type}}
      {{^vendorExtensions.x-metadata-type}}
    final _metadataVal = _json['metadata'];
      {{/vendorExtensions.x-metadata-type}}

    final value = ResponseWrapper<{{#vendorExtensions.x-generic-is-primitive}}List<{{vendorExtensions.x-generic-dart-type}}>{{/vendorExtensions.x-generic-is-primitive}}{{^vendorExtensions.x-generic-is-primitive}}List<{{vendorExtensions.x-generic-type}}>{{/vendorExtensions.x-generic-is-primitive}}>(
      data: _dataVal,
      message: _json['message'] as String?,
      metadata: _metadataVal,
      timestamp: _json['timestamp'] is String ? DateTime.parse(_json['timestamp']) : DateTime.now(),
    );

    return Response<ResponseWrapper<{{#vendorExtensions.x-generic-is-primitive}}List<{{vendorExtensions.x-generic-dart-type}}>{{/vendorExtensions.x-generic-is-primitive}}{{^vendorExtensions.x-generic-is-primitive}}List<{{vendorExtensions.x-generic-type}}>{{/vendorExtensions.x-generic-is-primitive}}>>(
      statusCode: _result.statusCode,
      data: value,
      headers: _result.headers,
      isRedirect: _result.isRedirect,
      requestOptions: _result.requestOptions,
      redirects: _result.redirects,
      extra: _result.extra,
    );
    {{/vendorExtensions.x-wrapper-type-is-list}}

    {{!-- PAGE --}}
    {{#vendorExtensions.x-wrapper-type-is-page}}
      {{#vendorExtensions.x-generic-is-primitive}}
  {{#vendorExtensions.x-generic-dart-type}}
  final _dataVal = (_json['data'] as List<dynamic>).map((e) => _convertPrimitiveByName('{{vendorExtensions.x-generic-dart-type}}', e) as {{vendorExtensions.x-generic-dart-type}}).toList();
  {{/vendorExtensions.x-generic-dart-type}}
  {{^vendorExtensions.x-generic-dart-type}}
  final _dataVal = (_json['data'] as List<dynamic>).map((e) => e).toList();
  {{/vendorExtensions.x-generic-dart-type}}
      {{/vendorExtensions.x-generic-is-primitive}}
      {{^vendorExtensions.x-generic-is-primitive}}
    final _dataVal = (_json['data'] as List<dynamic>)
      .map((e) => _serializers.deserializeWith(
        {{vendorExtensions.x-generic-type}}.serializer,
        (e as Map<String, dynamic>).map((k, v) => MapEntry(k, v)),
      )!)
      .toList();
      {{/vendorExtensions.x-generic-is-primitive}}

      {{#vendorExtensions.x-metadata-type}}
    final _metadataVal = _json['metadata'] == null
      ? null
      : _serializers.deserializeWith(
          {{vendorExtensions.x-metadata-type}}.serializer,
          (_json['metadata'] as Map<String, dynamic>).map((k, v) => MapEntry(k, v)),
        );
      {{/vendorExtensions.x-metadata-type}}
      {{^vendorExtensions.x-metadata-type}}
    final _metadataVal = _json['metadata'];
      {{/vendorExtensions.x-metadata-type}}

    final value = ResponseWrapper<{{#vendorExtensions.x-generic-is-primitive}}List<{{vendorExtensions.x-generic-dart-type}}>{{/vendorExtensions.x-generic-is-primitive}}{{^vendorExtensions.x-generic-is-primitive}}List<{{vendorExtensions.x-generic-type}}>{{/vendorExtensions.x-generic-is-primitive}}>(
      data: _dataVal,
      message: _json['message'] as String?,
      metadata: _metadataVal,
      timestamp: _json['timestamp'] is String ? DateTime.parse(_json['timestamp']) : DateTime.now(),
    );

    return Response<ResponseWrapper<{{#vendorExtensions.x-generic-is-primitive}}List<{{vendorExtensions.x-generic-dart-type}}>{{/vendorExtensions.x-generic-is-primitive}}{{^vendorExtensions.x-generic-is-primitive}}List<{{vendorExtensions.x-generic-type}}>{{/vendorExtensions.x-generic-is-primitive}}>>(
      statusCode: _result.statusCode,
      data: value,
      headers: _result.headers,
      isRedirect: _result.isRedirect,
      requestOptions: _result.requestOptions,
      redirects: _result.redirects,
      extra: _result.extra,
    );
    {{/vendorExtensions.x-wrapper-type-is-page}}

    {{!-- FALLBACK: if no wrapper-type flags are present, treat as SINGLE --}}
    {{^vendorExtensions.x-wrapper-type-is-single}}
      {{^vendorExtensions.x-wrapper-type-is-list}}
        {{^vendorExtensions.x-wrapper-type-is-page}}
    {{#vendorExtensions.x-generic-is-primitive}}
    // Using universal deserialization for primitive types (fallback)
    final value = ResponseWrapper<{{vendorExtensions.x-generic-dart-type}}>.fromJsonSafe(
      _result.data!,
      _serializers,
    );
    {{/vendorExtensions.x-generic-is-primitive}}
    {{^vendorExtensions.x-generic-is-primitive}}
    // Using universal deserialization for complex types (fallback)
    final value = ResponseWrapper<{{vendorExtensions.x-generic-type}}>.fromJsonSafe(
      _result.data!,
      _serializers,
      serializer: {{vendorExtensions.x-generic-type}}.serializer,
    );
    {{/vendorExtensions.x-generic-is-primitive}}
      timestamp: _json['timestamp'] is String ? DateTime.parse(_json['timestamp']) : DateTime.now(),
    );

    return Response<ResponseWrapper<{{#vendorExtensions.x-generic-is-primitive}}{{vendorExtensions.x-generic-dart-type}}{{/vendorExtensions.x-generic-is-primitive}}{{^vendorExtensions.x-generic-is-primitive}}{{vendorExtensions.x-generic-type}}{{/vendorExtensions.x-generic-is-primitive}}>>(
      statusCode: _result.statusCode,
      data: value,
      headers: _result.headers,
      isRedirect: _result.isRedirect,
      requestOptions: _result.requestOptions,
      redirects: _result.redirects,
      extra: _result.extra,
    );

        {{/vendorExtensions.x-wrapper-type-is-page}}
      {{/vendorExtensions.x-wrapper-type-is-list}}
    {{/vendorExtensions.x-wrapper-type-is-single}}
    {{/vendorExtensions.x-generic-type}}
    {{^vendorExtensions.x-generic-type}}
    final value = _serializers.deserializeWith({{&dataType}}.serializer, _result.data!.map<String, dynamic>((key, dynamic value) => MapEntry<String, dynamic>(key, value)))!;
    return Response<{{&dataType}}>(
      statusCode: _result.statusCode,
      data: value,
      headers: _result.headers,
      isRedirect: _result.isRedirect,
      requestOptions: _result.requestOptions,
      redirects: _result.redirects,
      extra: _result.extra,
    );
    {{/vendorExtensions.x-generic-type}}
    {{/returnType}}
    {{^returnType}}
    return _result;
    {{/returnType}}
  }

{{/operation}}
{{/operations}}
}

// Helper functions
String? _combineBaseUrls(String? dioBaseUrl, String? baseUrl) {
  if (baseUrl == null || baseUrl.trim().isEmpty) {
    return dioBaseUrl;
  }

  final url = Uri.parse(baseUrl);

  if (url.isAbsolute) {
    return url.toString();
  }

  return Uri.parse(dioBaseUrl!).resolveUri(url).toString();
}

T _setStreamType<T>() => null as T;

// Helper: convert primitive values based on a dart-type name
dynamic _convertPrimitiveByName(String dartTypeName, dynamic value) {
  if (value == null) return null;
  switch (dartTypeName) {
    case 'DateTime':
      if (value is String) return DateTime.parse(value);
      return value;
    case 'int':
      return value is int ? value : int.tryParse(value.toString());
    case 'double':
      return value is double ? value : double.tryParse(value.toString());
    case 'bool':
      if (value is bool) return value;
      if (value is String) return value.toLowerCase() == 'true';
      return value;
    case 'String':
      return value.toString();
    default:
      return value;
  }
}
