<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test - Greedy's API</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <style>
        body { font-family: Arial; margin: 20px; }
        #connect, #disconnect { padding: 10px 20px; margin: 5px; }
        #messages { border: 1px solid #ccc; height: 400px; overflow-y: auto; padding: 10px; margin-top: 20px; }
        .message { margin: 5px 0; padding: 5px; background: #f0f0f0; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>WebSocket Test - Greedy's API üöÄ</h1>
    
    <div>
        <label>API URL:</label>
        <input type="text" id="apiUrl" value="https://api.greedys.it" style="width: 300px;">
    </div>
    
    <div>
        <button id="connect" onclick="connect()">Connect WebSocket</button>
        <button id="disconnect" onclick="disconnect()" disabled>Disconnect</button>
    </div>
    
    <div>
        <h3>Connection Status:</h3>
        <p id="status">Not connected</p>
    </div>
    
    <div>
        <h3>Messages:</h3>
        <div id="messages"></div>
    </div>

    <script>
        let stompClient = null;
        const messagesDiv = document.getElementById('messages');
        const statusP = document.getElementById('status');
        const connectBtn = document.getElementById('connect');
        const disconnectBtn = document.getElementById('disconnect');
        const apiUrl = document.getElementById('apiUrl');

        function addMessage(msg, type = 'info') {
            const div = document.createElement('div');
            div.className = 'message ' + type;
            div.textContent = new Date().toLocaleTimeString() + ': ' + msg;
            messagesDiv.appendChild(div);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function connect() {
            const url = apiUrl.value + '/ws';
            addMessage(`Connecting to ${url}...`, 'info');
            
            const socket = new SockJS(url);
            stompClient = Stomp.over(socket);

            stompClient.connect(
                {},
                function(frame) {
                    addMessage('‚úÖ WebSocket Connected!', 'success');
                    statusP.textContent = 'Connected ‚úÖ';
                    statusP.style.color = 'green';
                    connectBtn.disabled = true;
                    disconnectBtn.disabled = false;

                    // Subscribe to a test topic
                    stompClient.subscribe('/topic/test', function(message) {
                        addMessage('üì¨ Received: ' + message.body, 'success');
                    });

                    addMessage('Subscribed to /topic/test', 'info');
                },
                function(error) {
                    addMessage('‚ùå Connection error: ' + error, 'error');
                    statusP.textContent = 'Connection Error ‚ùå';
                    statusP.style.color = 'red';
                    connectBtn.disabled = false;
                    disconnectBtn.disabled = true;
                }
            );
        }

        function disconnect() {
            if (stompClient !== null) {
                stompClient.disconnect(function() {
                    addMessage('Disconnected', 'info');
                    statusP.textContent = 'Disconnected';
                    statusP.style.color = 'orange';
                    connectBtn.disabled = false;
                    disconnectBtn.disabled = true;
                });
            }
        }

        // Auto-connect on load
        window.onload = function() {
            addMessage('WebSocket Test Ready. Click "Connect WebSocket" to start.', 'info');
        };
    </script>
</body>
</html>
