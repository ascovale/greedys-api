# ðŸ’¬ Chat, Support & Social Food System - Design Document

> **Versione**: 3.0  
> **Data**: 1 Dicembre 2025  
> **Autore**: Greedy's System Architecture

---

## ðŸ“‹ Executive Summary

Sistema completo di comunicazione, supporto e social food per tutti i tipi di utente (`AbstractUser`), con:
- **Chat 1:1** (Direct Messages)
- **Chat di Gruppo** (Group Conversations)
- **Sistema di Supporto/Assistenza** con ticketing
- **Bot Integration** per aiuto automatico (Restaurant, Customer, Agency)
- **ðŸ†• Social Food Feed** - Condivisione esperienze culinarie legate alle prenotazioni
- **ðŸ†• Media Upload** - Foto e video dei piatti/ristoranti
- **ðŸ†• Eventi** - Sistema eventi ristorante con RSVP

---

## ðŸŽ¯ Obiettivi

| Obiettivo | Descrizione |
|-----------|-------------|
| Comunicazione Unificata | Un sistema per Customer â†” Restaurant â†” Agency â†” Admin |
| Real-time | WebSocket per messaggi istantanei |
| Storico Completo | Tutti i messaggi salvati e auditati |
| Bot Support | Automazione risposte FAQ e assistenza |
| Multi-tenant | Isolamento dati per Restaurant/Agency |
| Scalabile | Design per alto volume di messaggi |
| **ðŸ†• Social Engagement** | Condivisione esperienze post-prenotazione |
| **ðŸ†• Media Rich** | Upload foto/video piatti e ristoranti |
| **ðŸ†• Eventi** | Promozione eventi ristorante con partecipazione |

---

## ðŸ—ï¸ Architettura Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CHAT & SUPPORT ARCHITECTURE                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                          CONVERSATION TYPES                          â”‚    â”‚
â”‚  â”‚                                                                       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚  DIRECT   â”‚  â”‚   GROUP   â”‚  â”‚  SUPPORT  â”‚  â”‚  RESERVATION_CHAT â”‚ â”‚    â”‚
â”‚  â”‚  â”‚   1:1     â”‚  â”‚   N:N     â”‚  â”‚  TICKET   â”‚  â”‚   (Reservation)   â”‚ â”‚    â”‚
â”‚  â”‚  â”‚           â”‚  â”‚           â”‚  â”‚           â”‚  â”‚                   â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ Customer  â”‚  â”‚ Restaurantâ”‚  â”‚ Any User  â”‚  â”‚ Customer â†” Staff  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚    â†”      â”‚  â”‚   Team    â”‚  â”‚    â†”      â”‚  â”‚  (per prenotaz.)  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ Restaurantâ”‚  â”‚   Chat    â”‚  â”‚ Bot/Admin â”‚  â”‚                   â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                    â”‚                                         â”‚
â”‚                                    â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                         CHAT SERVICE LAYER                           â”‚    â”‚
â”‚  â”‚                                                                       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚   ChatService    â”‚  â”‚  SupportService  â”‚  â”‚    BotService    â”‚   â”‚    â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ createConv()   â”‚  â”‚ â€¢ openTicket()   â”‚  â”‚ â€¢ processMsg()   â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ sendMessage()  â”‚  â”‚ â€¢ assignAgent()  â”‚  â”‚ â€¢ suggestReply() â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ addParticipant â”‚  â”‚ â€¢ escalate()     â”‚  â”‚ â€¢ autoResolve()  â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ archiveConv()  â”‚  â”‚ â€¢ closeTicket()  â”‚  â”‚ â€¢ trainModel()   â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                    â”‚                                         â”‚
â”‚                                    â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      NOTIFICATION FLOW (2-LEVEL)                     â”‚    â”‚
â”‚  â”‚                                                                       â”‚    â”‚
â”‚  â”‚  Level 1: EVENT OUTBOX                Level 2: ORCHESTRATOR          â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚    â”‚
â”‚  â”‚  ChatService creates:                 ChatOrchestrator:              â”‚    â”‚
â”‚  â”‚  EventOutbox {                        â€¢ Load conversation members    â”‚    â”‚
â”‚  â”‚    event_type: CHAT_MESSAGE_SENT      â€¢ For EACH participant:        â”‚    â”‚
â”‚  â”‚    aggregate_type: CHAT               â”‚   - Load preferences         â”‚    â”‚
â”‚  â”‚    payload: {conversationId,          â”‚   - Create notification      â”‚    â”‚
â”‚  â”‚              senderId, messageId}     â”‚   - Route to channels        â”‚    â”‚
â”‚  â”‚  }                                    â€¢ Exclude sender from notif    â”‚    â”‚
â”‚  â”‚                                       â€¢ Handle group vs direct       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“Š Tipi di Conversazione

### 1. DIRECT (1:1)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Customer   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Restaurant â”‚
â”‚   (User)    â”‚  Direct â”‚   (Staff)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   Chat  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
- Due partecipanti
- Privacy totale
- Esempio: Cliente chiede info a ristorante

### 2. GROUP (N:N)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Staff 1    â”‚â—„â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”œâ”€â”€â”€â–ºâ”‚   GROUP     â”‚
â”‚  Staff 2    â”‚â—„â”€â”€â”¤    â”‚   CHAT      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  Manager    â”‚â—„â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
- N partecipanti dello stesso restaurant/agency
- Team communication
- `readByAll` = true (un messaggio letto da uno = letto da tutti)

### 3. SUPPORT TICKET
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Customer  â”‚â”€â”€â”€â”€â”€â”€â”
â”‚   /Staff    â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
                     â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   SUPPORT   â”‚â—„â”€â”€â”€â”€â–ºâ”‚     BOT     â”‚
              â”‚   TICKET    â”‚      â”‚  (Auto-AI)  â”‚
              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   AGENT     â”‚
              â”‚  (Admin/    â”‚
              â”‚   Support)  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
- Utente apre ticket
- Bot tenta risposta automatica
- Se non risolto â†’ escalation a Agent umano
- Workflow: OPEN â†’ IN_PROGRESS â†’ WAITING_CUSTOMER â†’ RESOLVED â†’ CLOSED

### 4. RESERVATION_CHAT
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Customer   â”‚â—„â”€â”€â”€â”€â–ºâ”‚ RESERVATION â”‚â—„â”€â”€â”€â”€â–ºâ”‚  Restaurant â”‚
â”‚             â”‚      â”‚    CHAT     â”‚      â”‚    Staff    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ (contextual)â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
- Chat legata a una prenotazione specifica
- Context: prenotazione ID, data, orario, pax
- Auto-archivio dopo X giorni dalla data prenotazione

---

## ðŸ• SOCIAL FOOD SYSTEM

### Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SOCIAL FOOD ARCHITECTURE                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                         USER JOURNEY                                 â”‚    â”‚
â”‚  â”‚                                                                       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚    â”‚
â”‚  â”‚  â”‚ PRENOTA  â”‚â”€â”€â”€>â”‚  MANGIA  â”‚â”€â”€â”€>â”‚  POSTA   â”‚â”€â”€â”€>â”‚ CONDIVIDIâ”‚       â”‚    â”‚
â”‚  â”‚  â”‚          â”‚    â”‚          â”‚    â”‚          â”‚    â”‚          â”‚       â”‚    â”‚
â”‚  â”‚  â”‚Reservationâ”‚    â”‚ Check-in â”‚    â”‚Foto/Videoâ”‚    â”‚  Feed    â”‚       â”‚    â”‚
â”‚  â”‚  â”‚  System  â”‚    â”‚ (SEATED) â”‚    â”‚ + Review â”‚    â”‚  Social  â”‚       â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚    â”‚
â”‚  â”‚       â”‚                â”‚                â”‚                â”‚           â”‚    â”‚
â”‚  â”‚       â”‚                â”‚                â”‚                â”‚           â”‚    â”‚
â”‚  â”‚       â–¼                â–¼                â–¼                â–¼           â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚                    SOCIAL FEED TYPES                         â”‚    â”‚    â”‚
â”‚  â”‚  â”‚                                                               â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  POST   â”‚  â”‚  STORY  â”‚  â”‚  EVENT  â”‚  â”‚ REVIEW  â”‚         â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚         â”‚  â”‚         â”‚  â”‚         â”‚  â”‚         â”‚         â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ Foto +  â”‚  â”‚ 24h     â”‚  â”‚Ristoranteâ”‚ â”‚ Rating  â”‚         â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ Caption â”‚  â”‚ Content â”‚  â”‚ Events  â”‚  â”‚ + Text  â”‚         â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                    â”‚                                         â”‚
â”‚                                    â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                       INTERACTION LAYER                              â”‚    â”‚
â”‚  â”‚                                                                       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚    â”‚
â”‚  â”‚  â”‚   LIKE   â”‚  â”‚ COMMENT  â”‚  â”‚  SHARE   â”‚  â”‚  SAVE    â”‚            â”‚    â”‚
â”‚  â”‚  â”‚   â¤ï¸     â”‚  â”‚   ðŸ’¬     â”‚  â”‚   ðŸ“¤     â”‚  â”‚   ðŸ”–     â”‚            â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚    â”‚
â”‚  â”‚                                                                       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚    â”‚
â”‚  â”‚  â”‚  FOLLOW  â”‚  â”‚   TAG    â”‚  â”‚ MENTION  â”‚  â”‚   RSVP   â”‚            â”‚    â”‚
â”‚  â”‚  â”‚   ðŸ‘¤     â”‚  â”‚   ðŸ·ï¸     â”‚  â”‚   @      â”‚  â”‚   ðŸ“…     â”‚            â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tipi di Contenuto Social

#### 1. POST (Esperienza Culinaria)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST                                                           â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ðŸ“¸ MEDIA (1-10 foto/video)                              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”                                â”‚   â”‚
â”‚  â”‚  â”‚     â”‚ â”‚     â”‚ â”‚     â”‚  ...                           â”‚   â”‚
â”‚  â”‚  â”‚ IMG â”‚ â”‚ IMG â”‚ â”‚VIDEOâ”‚                                â”‚   â”‚
â”‚  â”‚  â”‚     â”‚ â”‚     â”‚ â”‚     â”‚                                â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  ðŸ‘¤ Mario Rossi                              ðŸ“ Da Gino         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  "Carbonara pazzesca! ðŸ Miglior esperienza dell'anno."         â”‚
â”‚                                                                 â”‚
â”‚  ðŸ”— Collegato a: Prenotazione #12345 del 28/11/2025            â”‚
â”‚  â­ Rating: â˜…â˜…â˜…â˜…â˜… (5/5)                                        â”‚
â”‚                                                                 â”‚
â”‚  ðŸ·ï¸ Tags: #carbonara #roma #cucinaromana #daGino               â”‚
â”‚  ðŸ“ Location: Roma, Via del Corso 123                           â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  â¤ï¸ 234  ðŸ’¬ 45  ðŸ“¤ 12  ðŸ”– Salva                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. STORY (Contenuto Temporaneo 24h)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            STORY (24h)                  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                 â”‚   â”‚
â”‚  â”‚         ðŸ“¸ FULL SCREEN         â”‚   â”‚
â”‚  â”‚            MEDIA               â”‚   â”‚
â”‚  â”‚                                 â”‚   â”‚
â”‚  â”‚     [Tap for next]              â”‚   â”‚
â”‚  â”‚                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  ðŸ‘¤ @mario_rossi â€¢ 2h ago              â”‚
â”‚  ðŸ“ Ristorante Da Gino                  â”‚
â”‚                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”‚
â”‚  [ðŸ‘ï¸ 156 views] [â¤ï¸ React] [ðŸ’¬ Reply]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3. EVENT (Eventi Ristorante)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸŽ‰ EVENT                                                       â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ðŸ–¼ï¸ EVENT COVER IMAGE                                    â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚      "Serata Degustazione Vini Toscani"                  â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  ðŸ“… VenerdÃ¬ 15 Dicembre 2025                                   â”‚
â”‚  ðŸ•– 19:30 - 23:00                                               â”‚
â”‚  ðŸ“ Ristorante Da Gino, Roma                                   â”‚
â”‚  ðŸ‘¥ 50 posti disponibili (32 prenotati)                        â”‚
â”‚  ðŸ’° â‚¬45 a persona (cena inclusa)                               â”‚
â”‚                                                                 â”‚
â”‚  ðŸ“ Descrizione:                                                â”‚
â”‚  "Una serata alla scoperta dei migliori vini toscani           â”‚
â”‚   accompagnati da piatti della tradizione..."                  â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  [âœ… PARTECIPO] [â“ INTERESSATO] [ðŸ“¤ CONDIVIDI]                â”‚
â”‚                                                                 â”‚
â”‚  ðŸ‘¥ Mario, Anna e altri 30 parteciperanno                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4. REVIEW (Recensione Post-Prenotazione)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â­ REVIEW                                                      â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                 â”‚
â”‚  ðŸ“ Ristorante Da Gino                    ðŸ“… 28 Nov 2025       â”‚
â”‚  ðŸ”— Prenotazione verificata âœ“                                  â”‚
â”‚                                                                 â”‚
â”‚  â­â­â­â­â­ (5/5)                                               â”‚
â”‚                                                                 â”‚
â”‚  Categorie:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  Cibo    â”‚ Servizio â”‚ Ambiente â”‚ Prezzo   â”‚                 â”‚
â”‚  â”‚  â­â­â­â­â­ â”‚  â­â­â­â­â˜†  â”‚  â­â­â­â­â­ â”‚  â­â­â­â­â˜†  â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                 â”‚
â”‚  "Esperienza fantastica! La carbonara Ã¨ la migliore            â”‚
â”‚   che abbia mai mangiato. Personale gentilissimo,              â”‚
â”‚   ambiente accogliente. TornerÃ² sicuramente!"                  â”‚
â”‚                                                                 â”‚
â”‚  ðŸ“¸ [+3 foto allegate]                                         â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  ðŸ‘ Utile (23)  ðŸ’¬ Risposte (2)                                â”‚
â”‚                                                                 â”‚
â”‚  ðŸ’¬ Risposta del ristorante:                                   â”‚
â”‚  "Grazie Mario! Siamo felici che ti sia piaciuto..."           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Social Feed Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          SOCIAL FEED ALGORITHM                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                        FEED COMPOSITION                              â”‚    â”‚
â”‚  â”‚                                                                       â”‚    â”‚
â”‚  â”‚  Customer Feed = f(Following, Location, Interests, Time)            â”‚    â”‚
â”‚  â”‚                                                                       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚    â”‚
â”‚  â”‚  â”‚   FOLLOWING   â”‚â”€â”€â”                                                â”‚    â”‚
â”‚  â”‚  â”‚ (Friends +    â”‚  â”‚                                                â”‚    â”‚
â”‚  â”‚  â”‚  Restaurants) â”‚  â”‚                                                â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                                â”‚    â”‚
â”‚  â”‚                     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”œâ”€â”€â”€>â”‚   RANKING    â”‚â”€â”€â”€>â”‚  FINAL FEED  â”‚        â”‚    â”‚
â”‚  â”‚  â”‚   LOCATION    â”‚  â”‚    â”‚   ENGINE     â”‚    â”‚              â”‚        â”‚    â”‚
â”‚  â”‚  â”‚ (Nearby posts)â”‚â”€â”€â”¤    â”‚              â”‚    â”‚ 1. Post A    â”‚        â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚ â€¢ Recency    â”‚    â”‚ 2. Event B   â”‚        â”‚    â”‚
â”‚  â”‚                     â”‚    â”‚ â€¢ Engagement â”‚    â”‚ 3. Story C   â”‚        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚ â€¢ Relevance  â”‚    â”‚ 4. Review D  â”‚        â”‚    â”‚
â”‚  â”‚  â”‚  INTERESTS    â”‚â”€â”€â”¤    â”‚ â€¢ Diversity  â”‚    â”‚ ...          â”‚        â”‚    â”‚
â”‚  â”‚  â”‚ (Cuisine tags)â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                                â”‚    â”‚
â”‚  â”‚                     â”‚                                                â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                                â”‚    â”‚
â”‚  â”‚  â”‚    EVENTS     â”‚â”€â”€â”˜                                                â”‚    â”‚
â”‚  â”‚  â”‚ (Upcoming)    â”‚                                                   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  Restaurant Feed = Posts about their restaurant + Customer reviews          â”‚
â”‚  Agency Feed = Aggregated posts from all managed restaurants               â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Post Creation Flow (Linked to Reservation)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Customer â”‚     â”‚ PostControllerâ”‚     â”‚ PostService â”‚     â”‚MediaUploadSvcâ”‚
â”‚  (App)   â”‚     â”‚              â”‚     â”‚             â”‚     â”‚              â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                   â”‚                    â”‚                   â”‚
     â”‚ 1. Select recent reservation          â”‚                   â”‚
     â”‚    (status=SEATED or completed)       â”‚                   â”‚
     â”‚                   â”‚                    â”‚                   â”‚
     â”‚ 2. Upload media   â”‚                    â”‚                   â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                   â”‚                    â”‚                   â”‚
     â”‚                   â”‚                    â”‚    S3/CloudStorageâ”‚
     â”‚                   â”‚                    â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                   â”‚                    â”‚    Return URLs    â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                   â”‚                    â”‚                   â”‚
     â”‚ 3. Create post    â”‚                    â”‚                   â”‚
     â”‚ POST /social/posts                     â”‚                   â”‚
     â”‚ {reservationId,   â”‚                    â”‚                   â”‚
     â”‚  mediaUrls[],     â”‚                    â”‚                   â”‚
     â”‚  caption,         â”‚                    â”‚                   â”‚
     â”‚  rating,          â”‚                    â”‚                   â”‚
     â”‚  tags[]}          â”‚                    â”‚                   â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                   â”‚
     â”‚                   â”‚                    â”‚                   â”‚
     â”‚                   â”‚ createPost()       â”‚                   â”‚
     â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
     â”‚                   â”‚                    â”‚                   â”‚
     â”‚                   â”‚                    â”‚ 1. Validate reservation
     â”‚                   â”‚                    â”‚    belongs to user
     â”‚                   â”‚                    â”‚                   â”‚
     â”‚                   â”‚                    â”‚ 2. Create SocialPost
     â”‚                   â”‚                    â”‚    with media refs
     â”‚                   â”‚                    â”‚                   â”‚
     â”‚                   â”‚                    â”‚ 3. Create EventOutbox
     â”‚                   â”‚                    â”‚    SOCIAL_POST_CREATED
     â”‚                   â”‚                    â”‚                   â”‚
     â”‚                   â”‚                    â”‚ 4. Update restaurant
     â”‚                   â”‚                    â”‚    average rating
     â”‚                   â”‚                    â”‚                   â”‚
     â”‚                   â”‚  PostDTO           â”‚                   â”‚
     â”‚                   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
     â”‚                   â”‚                    â”‚                   â”‚
     â”‚ 201 Created       â”‚                    â”‚                   â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚                   â”‚
```

### Event RSVP Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Customer â”‚     â”‚EventControllerâ”‚     â”‚ EventServiceâ”‚     â”‚ReservationSvcâ”‚
â”‚          â”‚     â”‚              â”‚     â”‚             â”‚     â”‚              â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                   â”‚                    â”‚                   â”‚
     â”‚ POST /social/events/{id}/rsvp         â”‚                   â”‚
     â”‚ {status: GOING}   â”‚                    â”‚                   â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                   â”‚
     â”‚                   â”‚                    â”‚                   â”‚
     â”‚                   â”‚ rsvpToEvent()      â”‚                   â”‚
     â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
     â”‚                   â”‚                    â”‚                   â”‚
     â”‚                   â”‚                    â”‚ 1. Check capacity
     â”‚                   â”‚                    â”‚                   â”‚
     â”‚                   â”‚                    â”‚ 2. Create EventRSVP
     â”‚                   â”‚                    â”‚    record           â”‚
     â”‚                   â”‚                    â”‚                   â”‚
     â”‚                   â”‚                    â”‚ IF event.requires_reservation
     â”‚                   â”‚                    â”‚ 3. Auto-create     â”‚
     â”‚                   â”‚                    â”‚    reservation     â”‚
     â”‚                   â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                   â”‚                    â”‚                   â”‚
     â”‚                   â”‚                    â”‚  Reservation       â”‚
     â”‚                   â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                   â”‚                    â”‚                   â”‚
     â”‚                   â”‚                    â”‚ 4. Create EventOutbox
     â”‚                   â”‚                    â”‚    EVENT_RSVP_CREATED
     â”‚                   â”‚                    â”‚                   â”‚
     â”‚                   â”‚                    â”‚ 5. Notify restaurant
     â”‚                   â”‚                    â”‚    (new participant)
     â”‚                   â”‚                    â”‚                   â”‚
     â”‚                   â”‚ EventRSVPDTO       â”‚                   â”‚
     â”‚                   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
     â”‚                   â”‚                    â”‚                   â”‚
     â”‚ 200 OK            â”‚                    â”‚                   â”‚
     â”‚ {rsvpId,          â”‚                    â”‚                   â”‚
     â”‚  reservationId}   â”‚                    â”‚                   â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚                   â”‚
```

---

## ðŸ“ Struttura File

```
greedys_api/src/main/java/com/application/
â”œâ”€â”€ common/
â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â””â”€â”€ event/
â”‚   â”‚       â””â”€â”€ EventType.java                    â† +Chat +Social +Event Types
â”‚   â”‚
â”‚   â”œâ”€â”€ persistence/
â”‚   â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â”‚   â”œâ”€â”€ chat/                             â† ðŸ†• CHAT PACKAGE
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ChatConversation.java         â† Conversazione base
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ChatParticipant.java          â† Partecipante (FK AbstractUser)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ChatMessage.java              â† Messaggio
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ChatMessageAttachment.java    â† Allegati
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ConversationType.java         â† Enum: DIRECT, GROUP, SUPPORT, RESERVATION
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ support/                          â† ðŸ†• SUPPORT PACKAGE
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SupportTicket.java            â† Ticket di supporto
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SupportTicketMessage.java     â† Messaggi nel ticket
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SupportCategory.java          â† Categorie FAQ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SupportFAQ.java               â† FAQ per bot
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ TicketStatus.java             â† Enum stati ticket
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ social/                           â† ðŸ†• SOCIAL PACKAGE
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SocialPost.java               â† Post con media
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SocialStory.java              â† Story 24h
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SocialMedia.java              â† Foto/Video
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SocialComment.java            â† Commenti
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SocialLike.java               â† Like/Reaction
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SocialFollow.java             â† Follow User/Restaurant
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SocialSave.java               â† Saved posts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SocialTag.java                â† Hashtags
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PostType.java                 â† Enum: POST, STORY, REVIEW
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ MediaType.java                â† Enum: IMAGE, VIDEO
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ event/                            â† ðŸ†• EVENTS PACKAGE
â”‚   â”‚   â”‚       â”œâ”€â”€ RestaurantEvent.java          â† Evento ristorante
â”‚   â”‚   â”‚       â”œâ”€â”€ EventRSVP.java                â† Partecipazione evento
â”‚   â”‚   â”‚       â”œâ”€â”€ EventCategory.java            â† Categoria evento
â”‚   â”‚   â”‚       â””â”€â”€ RSVPStatus.java               â† Enum: GOING, INTERESTED, NOT_GOING
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ dao/
â”‚   â”‚       â”œâ”€â”€ chat/                             â† ðŸ†• CHAT DAO
â”‚   â”‚       â”‚   â”œâ”€â”€ ChatConversationDAO.java
â”‚   â”‚       â”‚   â”œâ”€â”€ ChatParticipantDAO.java
â”‚   â”‚       â”‚   â”œâ”€â”€ ChatMessageDAO.java
â”‚   â”‚       â”‚   â””â”€â”€ ChatMessageAttachmentDAO.java
â”‚   â”‚       â”‚
â”‚   â”‚       â”œâ”€â”€ support/                          â† ðŸ†• SUPPORT DAO
â”‚   â”‚       â”‚   â”œâ”€â”€ SupportTicketDAO.java
â”‚   â”‚       â”‚   â”œâ”€â”€ SupportTicketMessageDAO.java
â”‚   â”‚       â”‚   â””â”€â”€ SupportFAQDAO.java
â”‚   â”‚       â”‚
â”‚   â”‚       â”œâ”€â”€ social/                           â† ðŸ†• SOCIAL DAO
â”‚   â”‚       â”‚   â”œâ”€â”€ SocialPostDAO.java
â”‚   â”‚       â”‚   â”œâ”€â”€ SocialStoryDAO.java
â”‚   â”‚       â”‚   â”œâ”€â”€ SocialMediaDAO.java
â”‚   â”‚       â”‚   â”œâ”€â”€ SocialCommentDAO.java
â”‚   â”‚       â”‚   â”œâ”€â”€ SocialLikeDAO.java
â”‚   â”‚       â”‚   â”œâ”€â”€ SocialFollowDAO.java
â”‚   â”‚       â”‚   â””â”€â”€ SocialSaveDAO.java
â”‚   â”‚       â”‚
â”‚   â”‚       â””â”€â”€ event/                            â† ðŸ†• EVENT DAO
â”‚   â”‚           â”œâ”€â”€ RestaurantEventDAO.java
â”‚   â”‚           â””â”€â”€ EventRSVPDAO.java
â”‚   â”‚
â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”œâ”€â”€ chat/                                 â† ðŸ†• CHAT SERVICE
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatService.java                  â† CRUD conversazioni e messaggi
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatNotificationService.java      â† Crea EventOutbox per chat
â”‚   â”‚   â”‚   â””â”€â”€ ChatParticipantService.java       â† Gestione partecipanti
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ support/                              â† ðŸ†• SUPPORT SERVICE
â”‚   â”‚   â”‚   â”œâ”€â”€ SupportTicketService.java         â† CRUD ticket
â”‚   â”‚   â”‚   â”œâ”€â”€ SupportBotService.java            â† Bot auto-risposta
â”‚   â”‚   â”‚   â””â”€â”€ SupportAssignmentService.java     â† Assegnazione agenti
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ social/                               â† ðŸ†• SOCIAL SERVICE
â”‚   â”‚   â”‚   â”œâ”€â”€ SocialPostService.java            â† CRUD post/story
â”‚   â”‚   â”‚   â”œâ”€â”€ SocialFeedService.java            â† Algoritmo feed
â”‚   â”‚   â”‚   â”œâ”€â”€ SocialInteractionService.java     â† Like/Comment/Share
â”‚   â”‚   â”‚   â”œâ”€â”€ SocialFollowService.java          â† Follow/Unfollow
â”‚   â”‚   â”‚   â””â”€â”€ MediaUploadService.java           â† Upload S3/CloudStorage
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ event/                                â† ðŸ†• EVENT SERVICE
â”‚   â”‚   â”‚   â”œâ”€â”€ RestaurantEventService.java       â† CRUD eventi
â”‚   â”‚   â”‚   â””â”€â”€ EventRSVPService.java             â† Gestione partecipazioni
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ notification/
â”‚   â”‚       â””â”€â”€ orchestrator/
â”‚   â”‚           â”œâ”€â”€ ChatOrchestrator.java         â† Notifiche chat
â”‚   â”‚           â””â”€â”€ SocialOrchestrator.java       â† ðŸ†• Notifiche social
â”‚   â”‚
â”‚   â””â”€â”€ web/
â”‚       â”œâ”€â”€ controller/
â”‚       â”‚   â”œâ”€â”€ ChatController.java               â† REST API chat
â”‚       â”‚   â”œâ”€â”€ SupportController.java            â† REST API support
â”‚       â”‚   â”œâ”€â”€ SocialPostController.java         â† ðŸ†• REST API social posts
â”‚       â”‚   â”œâ”€â”€ SocialFeedController.java         â† ðŸ†• REST API feed
â”‚       â”‚   â””â”€â”€ RestaurantEventController.java    â† ðŸ†• REST API events
â”‚       â”‚
â”‚       â””â”€â”€ dto/
â”‚           â”œâ”€â”€ chat/                             â† CHAT DTO
â”‚           â”‚   â”œâ”€â”€ ChatConversationDTO.java
â”‚           â”‚   â”œâ”€â”€ ChatMessageDTO.java
â”‚           â”‚   â”œâ”€â”€ NewMessageDTO.java
â”‚           â”‚   â””â”€â”€ CreateConversationDTO.java
â”‚           â”‚
â”‚           â”œâ”€â”€ support/                          â† SUPPORT DTO
â”‚           â”‚   â”œâ”€â”€ SupportTicketDTO.java
â”‚           â”‚   â”œâ”€â”€ CreateTicketDTO.java
â”‚           â”‚   â””â”€â”€ TicketMessageDTO.java
â”‚           â”‚
â”‚           â”œâ”€â”€ social/                           â† ðŸ†• SOCIAL DTO
â”‚           â”‚   â”œâ”€â”€ SocialPostDTO.java
â”‚           â”‚   â”œâ”€â”€ CreatePostDTO.java
â”‚           â”‚   â”œâ”€â”€ SocialStoryDTO.java
â”‚           â”‚   â”œâ”€â”€ SocialCommentDTO.java
â”‚           â”‚   â”œâ”€â”€ SocialFeedDTO.java
â”‚           â”‚   â””â”€â”€ MediaUploadDTO.java
â”‚           â”‚
â”‚           â””â”€â”€ event/                            â† ðŸ†• EVENT DTO
â”‚               â”œâ”€â”€ RestaurantEventDTO.java
â”‚               â”œâ”€â”€ CreateEventDTO.java
â”‚               â””â”€â”€ EventRSVPDTO.java
â”‚
â”œâ”€â”€ customer/
â”‚   â””â”€â”€ web/controller/
â”‚       â”œâ”€â”€ CustomerChatController.java           â† Customer chat endpoints
â”‚       â”œâ”€â”€ CustomerSocialController.java         â† ðŸ†• Customer social endpoints
â”‚       â””â”€â”€ CustomerEventController.java          â† ðŸ†• Customer event endpoints
â”‚
â”œâ”€â”€ restaurant/
â”‚   â””â”€â”€ web/controller/
â”‚       â”œâ”€â”€ RestaurantChatController.java         â† Restaurant chat endpoints
â”‚       â”œâ”€â”€ RestaurantSocialController.java       â† ðŸ†• Restaurant social endpoints
â”‚       â””â”€â”€ RestaurantEventController.java        â† ðŸ†• Restaurant event management
â”‚
â”œâ”€â”€ agency/
â”‚   â””â”€â”€ web/controller/
â”‚       â”œâ”€â”€ AgencyChatController.java             â† Agency chat endpoints
â”‚       â””â”€â”€ AgencySocialController.java           â† ðŸ†• Agency social aggregation
â”‚
â””â”€â”€ admin/
    â””â”€â”€ web/controller/
        â”œâ”€â”€ AdminSupportController.java           â† Admin support management
        â””â”€â”€ AdminSocialModerationController.java  â† ðŸ†• Content moderation
```

---

## ðŸ—„ï¸ Database Schema

```sql
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- CHAT TABLES
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CREATE TABLE chat_conversation (
    id                  BIGINT PRIMARY KEY AUTO_INCREMENT,
    conversation_type   VARCHAR(20) NOT NULL,  -- DIRECT, GROUP, SUPPORT, RESERVATION
    title               VARCHAR(255),          -- NULL for DIRECT, name for GROUP
    reservation_id      BIGINT,                -- FK to reservation (for RESERVATION type)
    restaurant_id       BIGINT,                -- Context: which restaurant
    agency_id           BIGINT,                -- Context: which agency (if applicable)
    created_at          DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    created_by_id       BIGINT NOT NULL,       -- FK to abstract_user
    updated_at          DATETIME,
    is_archived         BOOLEAN DEFAULT FALSE,
    archived_at         DATETIME,
    metadata            JSON,                  -- Extra context data
    
    INDEX idx_conv_type (conversation_type),
    INDEX idx_conv_restaurant (restaurant_id),
    INDEX idx_conv_reservation (reservation_id),
    FOREIGN KEY (reservation_id) REFERENCES reservation(id),
    FOREIGN KEY (restaurant_id) REFERENCES restaurant(id),
    FOREIGN KEY (created_by_id) REFERENCES abstract_user(id)
);

CREATE TABLE chat_participant (
    id                  BIGINT PRIMARY KEY AUTO_INCREMENT,
    conversation_id     BIGINT NOT NULL,       -- FK to chat_conversation
    user_id             BIGINT NOT NULL,       -- FK to abstract_user (polimorphic)
    role                VARCHAR(20) NOT NULL,  -- OWNER, ADMIN, MEMBER
    joined_at           DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    left_at             DATETIME,              -- NULL if still active
    is_muted            BOOLEAN DEFAULT FALSE,
    last_read_at        DATETIME,              -- Last time user read messages
    last_read_message_id BIGINT,               -- Last message read
    
    UNIQUE KEY uk_conv_user (conversation_id, user_id),
    INDEX idx_participant_user (user_id),
    FOREIGN KEY (conversation_id) REFERENCES chat_conversation(id),
    FOREIGN KEY (user_id) REFERENCES abstract_user(id)
);

CREATE TABLE chat_message (
    id                  BIGINT PRIMARY KEY AUTO_INCREMENT,
    conversation_id     BIGINT NOT NULL,       -- FK to chat_conversation
    sender_id           BIGINT NOT NULL,       -- FK to abstract_user
    message_type        VARCHAR(20) NOT NULL,  -- TEXT, IMAGE, FILE, SYSTEM, BOT
    content             TEXT NOT NULL,
    reply_to_message_id BIGINT,                -- FK to chat_message (reply thread)
    is_edited           BOOLEAN DEFAULT FALSE,
    edited_at           DATETIME,
    is_deleted          BOOLEAN DEFAULT FALSE,
    deleted_at          DATETIME,
    created_at          DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    metadata            JSON,                  -- reactions, mentions, etc.
    
    INDEX idx_msg_conversation (conversation_id),
    INDEX idx_msg_sender (sender_id),
    INDEX idx_msg_created (created_at),
    FOREIGN KEY (conversation_id) REFERENCES chat_conversation(id),
    FOREIGN KEY (sender_id) REFERENCES abstract_user(id),
    FOREIGN KEY (reply_to_message_id) REFERENCES chat_message(id)
);

CREATE TABLE chat_message_attachment (
    id                  BIGINT PRIMARY KEY AUTO_INCREMENT,
    message_id          BIGINT NOT NULL,       -- FK to chat_message
    file_name           VARCHAR(255) NOT NULL,
    file_type           VARCHAR(100) NOT NULL, -- MIME type
    file_size           BIGINT NOT NULL,       -- bytes
    storage_path        VARCHAR(500) NOT NULL, -- S3/local path
    thumbnail_path      VARCHAR(500),          -- for images
    created_at          DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (message_id) REFERENCES chat_message(id)
);

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- SUPPORT TABLES
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CREATE TABLE support_ticket (
    id                  BIGINT PRIMARY KEY AUTO_INCREMENT,
    ticket_number       VARCHAR(20) NOT NULL UNIQUE, -- SUPP-2025-000001
    requester_id        BIGINT NOT NULL,       -- FK to abstract_user
    assigned_agent_id   BIGINT,                -- FK to abstract_user (support agent)
    category            VARCHAR(50) NOT NULL,  -- RESERVATION, PAYMENT, TECHNICAL, OTHER
    subcategory         VARCHAR(50),
    subject             VARCHAR(255) NOT NULL,
    priority            VARCHAR(20) NOT NULL DEFAULT 'MEDIUM', -- LOW, MEDIUM, HIGH, URGENT
    status              VARCHAR(30) NOT NULL DEFAULT 'OPEN',   -- See TicketStatus enum
    restaurant_id       BIGINT,                -- Context (if about specific restaurant)
    reservation_id      BIGINT,                -- Context (if about specific reservation)
    first_response_at   DATETIME,              -- SLA tracking
    resolved_at         DATETIME,
    closed_at           DATETIME,
    created_at          DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at          DATETIME,
    metadata            JSON,
    
    INDEX idx_ticket_status (status),
    INDEX idx_ticket_requester (requester_id),
    INDEX idx_ticket_agent (assigned_agent_id),
    INDEX idx_ticket_restaurant (restaurant_id),
    FOREIGN KEY (requester_id) REFERENCES abstract_user(id),
    FOREIGN KEY (assigned_agent_id) REFERENCES abstract_user(id),
    FOREIGN KEY (restaurant_id) REFERENCES restaurant(id),
    FOREIGN KEY (reservation_id) REFERENCES reservation(id)
);

CREATE TABLE support_ticket_message (
    id                  BIGINT PRIMARY KEY AUTO_INCREMENT,
    ticket_id           BIGINT NOT NULL,       -- FK to support_ticket
    sender_id           BIGINT,                -- FK to abstract_user (NULL for BOT)
    sender_type         VARCHAR(20) NOT NULL,  -- CUSTOMER, AGENT, BOT, SYSTEM
    content             TEXT NOT NULL,
    is_internal_note    BOOLEAN DEFAULT FALSE, -- Agent-only notes
    created_at          DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    metadata            JSON,
    
    INDEX idx_ticket_msg (ticket_id),
    FOREIGN KEY (ticket_id) REFERENCES support_ticket(id),
    FOREIGN KEY (sender_id) REFERENCES abstract_user(id)
);

CREATE TABLE support_faq (
    id                  BIGINT PRIMARY KEY AUTO_INCREMENT,
    category            VARCHAR(50) NOT NULL,
    question            TEXT NOT NULL,
    answer              TEXT NOT NULL,
    keywords            TEXT,                  -- For bot matching
    target_user_type    VARCHAR(50),           -- CUSTOMER, RESTAURANT, AGENCY, ALL
    restaurant_id       BIGINT,                -- NULL = global, otherwise restaurant-specific
    is_active           BOOLEAN DEFAULT TRUE,
    usage_count         INT DEFAULT 0,         -- Analytics
    helpful_count       INT DEFAULT 0,
    created_at          DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at          DATETIME,
    
    INDEX idx_faq_category (category),
    INDEX idx_faq_user_type (target_user_type),
    FOREIGN KEY (restaurant_id) REFERENCES restaurant(id)
);

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ðŸ†• SOCIAL TABLES
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CREATE TABLE social_post (
    id                  BIGINT PRIMARY KEY AUTO_INCREMENT,
    author_id           BIGINT NOT NULL,       -- FK to abstract_user
    post_type           VARCHAR(20) NOT NULL,  -- POST, STORY, REVIEW
    reservation_id      BIGINT,                -- FK to reservation (if linked)
    restaurant_id       BIGINT,                -- FK to restaurant (tagged)
    content             TEXT,                  -- Caption/text
    rating              DECIMAL(2,1),          -- 1.0-5.0 (for REVIEW type)
    rating_food         DECIMAL(2,1),          -- Sub-rating
    rating_service      DECIMAL(2,1),          -- Sub-rating
    rating_ambience     DECIMAL(2,1),          -- Sub-rating
    rating_value        DECIMAL(2,1),          -- Sub-rating (price/value)
    location_lat        DECIMAL(10,8),         -- Geo location
    location_lng        DECIMAL(11,8),
    location_name       VARCHAR(255),          -- "Roma, Via del Corso"
    visibility          VARCHAR(20) DEFAULT 'PUBLIC', -- PUBLIC, FOLLOWERS, PRIVATE
    is_verified_visit   BOOLEAN DEFAULT FALSE, -- Linked to completed reservation
    likes_count         INT DEFAULT 0,         -- Denormalized counter
    comments_count      INT DEFAULT 0,         -- Denormalized counter
    shares_count        INT DEFAULT 0,         -- Denormalized counter
    saves_count         INT DEFAULT 0,         -- Denormalized counter
    expires_at          DATETIME,              -- For STORY (24h expiry)
    is_archived         BOOLEAN DEFAULT FALSE,
    is_deleted          BOOLEAN DEFAULT FALSE,
    created_at          DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at          DATETIME,
    
    INDEX idx_post_author (author_id),
    INDEX idx_post_restaurant (restaurant_id),
    INDEX idx_post_reservation (reservation_id),
    INDEX idx_post_type (post_type),
    INDEX idx_post_created (created_at),
    INDEX idx_post_expires (expires_at),
    FOREIGN KEY (author_id) REFERENCES abstract_user(id),
    FOREIGN KEY (reservation_id) REFERENCES reservation(id),
    FOREIGN KEY (restaurant_id) REFERENCES restaurant(id)
);

CREATE TABLE social_media (
    id                  BIGINT PRIMARY KEY AUTO_INCREMENT,
    post_id             BIGINT NOT NULL,       -- FK to social_post
    media_type          VARCHAR(20) NOT NULL,  -- IMAGE, VIDEO
    storage_url         VARCHAR(500) NOT NULL, -- S3/CloudStorage URL
    thumbnail_url       VARCHAR(500),          -- For video previews
    original_filename   VARCHAR(255),
    file_size           BIGINT,                -- bytes
    width               INT,                   -- pixels
    height              INT,                   -- pixels
    duration_seconds    INT,                   -- for VIDEO
    display_order       INT DEFAULT 0,         -- Order in carousel
    alt_text            VARCHAR(500),          -- Accessibility
    created_at          DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_media_post (post_id),
    FOREIGN KEY (post_id) REFERENCES social_post(id) ON DELETE CASCADE
);

CREATE TABLE social_comment (
    id                  BIGINT PRIMARY KEY AUTO_INCREMENT,
    post_id             BIGINT NOT NULL,       -- FK to social_post
    author_id           BIGINT NOT NULL,       -- FK to abstract_user
    parent_comment_id   BIGINT,                -- FK to social_comment (reply)
    content             TEXT NOT NULL,
    likes_count         INT DEFAULT 0,
    is_edited           BOOLEAN DEFAULT FALSE,
    is_deleted          BOOLEAN DEFAULT FALSE,
    is_restaurant_reply BOOLEAN DEFAULT FALSE, -- Response from restaurant
    created_at          DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at          DATETIME,
    
    INDEX idx_comment_post (post_id),
    INDEX idx_comment_author (author_id),
    INDEX idx_comment_parent (parent_comment_id),
    FOREIGN KEY (post_id) REFERENCES social_post(id) ON DELETE CASCADE,
    FOREIGN KEY (author_id) REFERENCES abstract_user(id),
    FOREIGN KEY (parent_comment_id) REFERENCES social_comment(id)
);

CREATE TABLE social_like (
    id                  BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id             BIGINT NOT NULL,       -- FK to abstract_user
    post_id             BIGINT,                -- FK to social_post
    comment_id          BIGINT,                -- FK to social_comment (mutual exclusive)
    reaction_type       VARCHAR(20) DEFAULT 'LIKE', -- LIKE, LOVE, YUM, WOW
    created_at          DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    UNIQUE KEY uk_like_post (user_id, post_id),
    UNIQUE KEY uk_like_comment (user_id, comment_id),
    INDEX idx_like_user (user_id),
    INDEX idx_like_post (post_id),
    FOREIGN KEY (user_id) REFERENCES abstract_user(id),
    FOREIGN KEY (post_id) REFERENCES social_post(id) ON DELETE CASCADE,
    FOREIGN KEY (comment_id) REFERENCES social_comment(id) ON DELETE CASCADE
);

CREATE TABLE social_follow (
    id                  BIGINT PRIMARY KEY AUTO_INCREMENT,
    follower_id         BIGINT NOT NULL,       -- FK to abstract_user (who follows)
    followed_user_id    BIGINT,                -- FK to abstract_user (followed person)
    followed_restaurant_id BIGINT,             -- FK to restaurant (followed restaurant)
    created_at          DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    UNIQUE KEY uk_follow_user (follower_id, followed_user_id),
    UNIQUE KEY uk_follow_restaurant (follower_id, followed_restaurant_id),
    INDEX idx_follow_follower (follower_id),
    INDEX idx_follow_user (followed_user_id),
    INDEX idx_follow_restaurant (followed_restaurant_id),
    FOREIGN KEY (follower_id) REFERENCES abstract_user(id),
    FOREIGN KEY (followed_user_id) REFERENCES abstract_user(id),
    FOREIGN KEY (followed_restaurant_id) REFERENCES restaurant(id)
);

CREATE TABLE social_save (
    id                  BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id             BIGINT NOT NULL,       -- FK to abstract_user
    post_id             BIGINT NOT NULL,       -- FK to social_post
    collection_name     VARCHAR(100) DEFAULT 'Saved', -- User's collections
    created_at          DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    UNIQUE KEY uk_save (user_id, post_id),
    INDEX idx_save_user (user_id),
    FOREIGN KEY (user_id) REFERENCES abstract_user(id),
    FOREIGN KEY (post_id) REFERENCES social_post(id) ON DELETE CASCADE
);

CREATE TABLE social_tag (
    id                  BIGINT PRIMARY KEY AUTO_INCREMENT,
    name                VARCHAR(100) NOT NULL, -- hashtag without #
    name_normalized     VARCHAR(100) NOT NULL, -- lowercase, no special chars
    usage_count         INT DEFAULT 0,         -- How many posts use this
    created_at          DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    UNIQUE KEY uk_tag_name (name_normalized),
    INDEX idx_tag_usage (usage_count DESC)
);

CREATE TABLE social_post_tag (
    post_id             BIGINT NOT NULL,
    tag_id              BIGINT NOT NULL,
    
    PRIMARY KEY (post_id, tag_id),
    FOREIGN KEY (post_id) REFERENCES social_post(id) ON DELETE CASCADE,
    FOREIGN KEY (tag_id) REFERENCES social_tag(id)
);

CREATE TABLE social_mention (
    id                  BIGINT PRIMARY KEY AUTO_INCREMENT,
    post_id             BIGINT,                -- FK to social_post
    comment_id          BIGINT,                -- FK to social_comment
    mentioned_user_id   BIGINT NOT NULL,       -- FK to abstract_user
    created_at          DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_mention_user (mentioned_user_id),
    FOREIGN KEY (post_id) REFERENCES social_post(id) ON DELETE CASCADE,
    FOREIGN KEY (comment_id) REFERENCES social_comment(id) ON DELETE CASCADE,
    FOREIGN KEY (mentioned_user_id) REFERENCES abstract_user(id)
);

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ðŸ†• RESTAURANT EVENT TABLES
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CREATE TABLE restaurant_event (
    id                  BIGINT PRIMARY KEY AUTO_INCREMENT,
    restaurant_id       BIGINT NOT NULL,       -- FK to restaurant
    created_by_id       BIGINT NOT NULL,       -- FK to abstract_user (staff)
    title               VARCHAR(255) NOT NULL,
    description         TEXT,
    category            VARCHAR(50) NOT NULL,  -- WINE_TASTING, LIVE_MUSIC, SPECIAL_MENU, COOKING_CLASS, etc.
    cover_image_url     VARCHAR(500),
    event_date          DATE NOT NULL,
    start_time          TIME NOT NULL,
    end_time            TIME,
    price_per_person    DECIMAL(10,2),         -- NULL = free
    currency            VARCHAR(3) DEFAULT 'EUR',
    max_capacity        INT,                   -- NULL = unlimited
    current_rsvp_count  INT DEFAULT 0,         -- Denormalized
    requires_reservation BOOLEAN DEFAULT TRUE, -- Auto-create reservation on RSVP
    is_published        BOOLEAN DEFAULT FALSE,
    published_at        DATETIME,
    is_cancelled        BOOLEAN DEFAULT FALSE,
    cancelled_at        DATETIME,
    cancellation_reason VARCHAR(500),
    created_at          DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at          DATETIME,
    
    INDEX idx_event_restaurant (restaurant_id),
    INDEX idx_event_date (event_date),
    INDEX idx_event_category (category),
    INDEX idx_event_published (is_published, event_date),
    FOREIGN KEY (restaurant_id) REFERENCES restaurant(id),
    FOREIGN KEY (created_by_id) REFERENCES abstract_user(id)
);

CREATE TABLE event_rsvp (
    id                  BIGINT PRIMARY KEY AUTO_INCREMENT,
    event_id            BIGINT NOT NULL,       -- FK to restaurant_event
    user_id             BIGINT NOT NULL,       -- FK to abstract_user
    reservation_id      BIGINT,                -- FK to reservation (auto-created)
    status              VARCHAR(20) NOT NULL,  -- GOING, INTERESTED, NOT_GOING
    party_size          INT DEFAULT 1,         -- How many people
    notes               TEXT,                  -- Special requests
    created_at          DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at          DATETIME,
    
    UNIQUE KEY uk_rsvp (event_id, user_id),
    INDEX idx_rsvp_event (event_id),
    INDEX idx_rsvp_user (user_id),
    INDEX idx_rsvp_status (status),
    FOREIGN KEY (event_id) REFERENCES restaurant_event(id),
    FOREIGN KEY (user_id) REFERENCES abstract_user(id),
    FOREIGN KEY (reservation_id) REFERENCES reservation(id)
);

CREATE TABLE event_media (
    id                  BIGINT PRIMARY KEY AUTO_INCREMENT,
    event_id            BIGINT NOT NULL,       -- FK to restaurant_event
    media_type          VARCHAR(20) NOT NULL,  -- IMAGE, VIDEO
    storage_url         VARCHAR(500) NOT NULL,
    thumbnail_url       VARCHAR(500),
    display_order       INT DEFAULT 0,
    is_cover            BOOLEAN DEFAULT FALSE,
    created_at          DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_event_media (event_id),
    FOREIGN KEY (event_id) REFERENCES restaurant_event(id) ON DELETE CASCADE
);
```

---

## ï¿½ RabbitMQ Queues & WebSocket Channels

> **IMPORTANTE**: Questa sezione definisce l'architettura completa di routing per messaggi Chat/Social/Events attraverso RabbitMQ e WebSocket.

### Overview Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CHAT/SOCIAL/EVENTS MESSAGE ROUTING ARCHITECTURE                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                          EVENT SOURCES (Services)                            â”‚    â”‚
â”‚  â”‚                                                                               â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚ ChatService   â”‚  â”‚ SupportService â”‚  â”‚ SocialService   â”‚  â”‚EventServiceâ”‚ â”‚    â”‚
â”‚  â”‚  â”‚               â”‚  â”‚                â”‚  â”‚                 â”‚  â”‚            â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ sendMessage() â”‚  â”‚ createTicket() â”‚  â”‚ createPost()    â”‚  â”‚ rsvpEvent()â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â”‚          â”‚                   â”‚                    â”‚                  â”‚        â”‚    â”‚
â”‚  â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚    â”‚
â”‚  â”‚                              â”‚                    â”‚                           â”‚    â”‚
â”‚  â”‚                              â–¼                    â–¼                           â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚                      EventOutbox TABLE (L0)                            â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  INSERT INTO event_outbox (event_type, aggregate_type, payload...)     â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                           â”‚                                          â”‚
â”‚                                           â”‚ @Scheduled(1s)                           â”‚
â”‚                                           â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      EventOutboxOrchestrator (PRODUCER)                      â”‚    â”‚
â”‚  â”‚                                                                               â”‚    â”‚
â”‚  â”‚  determineTargetQueue() based on event_type:                                 â”‚    â”‚
â”‚  â”‚                                                                               â”‚    â”‚
â”‚  â”‚  CHAT_MESSAGE_SENT           â†’ notification.chat.direct                      â”‚    â”‚
â”‚  â”‚  CHAT_GROUP_MESSAGE_SENT     â†’ notification.chat.group                       â”‚    â”‚
â”‚  â”‚  SUPPORT_TICKET_*            â†’ notification.chat.support                     â”‚    â”‚
â”‚  â”‚  SOCIAL_POST_*, SOCIAL_LIKE  â†’ notification.social.feed                      â”‚    â”‚
â”‚  â”‚  EVENT_RSVP_*, EVENT_*       â†’ notification.social.events                    â”‚    â”‚
â”‚  â”‚                                                                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                           â”‚                                          â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚              â”‚                            â”‚                            â”‚             â”‚
â”‚              â–¼                            â–¼                            â–¼             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ CHAT QUEUES       â”‚    â”‚ SOCIAL QUEUES         â”‚    â”‚ EXISTING QUEUES        â”‚   â”‚
â”‚  â”‚                   â”‚    â”‚                       â”‚    â”‚                        â”‚   â”‚
â”‚  â”‚ .chat.direct      â”‚    â”‚ .social.feed          â”‚    â”‚ .restaurant.reservat.  â”‚   â”‚
â”‚  â”‚ .chat.group       â”‚    â”‚ .social.events        â”‚    â”‚ .customer              â”‚   â”‚
â”‚  â”‚ .chat.support     â”‚    â”‚                       â”‚    â”‚ .agency                â”‚   â”‚
â”‚  â”‚ .chat.reservation â”‚    â”‚                       â”‚    â”‚ .admin                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚            â”‚                          â”‚                            â”‚                â”‚
â”‚            â–¼                          â–¼                            â–¼                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ChatOrchestrator  â”‚    â”‚ SocialOrchestrator    â”‚    â”‚ RestaurantTeam/        â”‚   â”‚
â”‚  â”‚                   â”‚    â”‚                       â”‚    â”‚ CustomerOrchestrator   â”‚   â”‚
â”‚  â”‚ disaggregate()    â”‚    â”‚ disaggregate()        â”‚    â”‚                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚            â”‚                          â”‚                            â”‚                â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                       â”‚                                              â”‚
â”‚                                       â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                         WebSocket STOMP Delivery                             â”‚    â”‚
â”‚  â”‚                                                                               â”‚    â”‚
â”‚  â”‚  stompTemplate.convertAndSend(destination, notification)                     â”‚    â”‚
â”‚  â”‚                                                                               â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚                    WEBSOCKET DESTINATIONS                            â”‚    â”‚    â”‚
â”‚  â”‚  â”‚                                                                       â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  CHAT DESTINATIONS:                                                  â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  /topic/chat/{conversationId}              â† Group/Reservation chat  â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  /user/{userId}/queue/chat                 â† Direct messages         â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  /topic/chat/{conversationId}/typing       â† Typing indicators       â”‚    â”‚    â”‚
â”‚  â”‚  â”‚                                                                       â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  SUPPORT DESTINATIONS:                                               â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  /topic/support/{ticketId}                 â† Ticket updates          â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  /user/{userId}/queue/support              â† User's ticket notifs    â”‚    â”‚    â”‚
â”‚  â”‚  â”‚                                                                       â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  SOCIAL DESTINATIONS:                                                â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  /user/{userId}/queue/social               â† Personal notifications  â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  /topic/social/restaurant/{restaurantId}   â† Restaurant feed updates â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  /topic/social/post/{postId}               â† Post interactions       â”‚    â”‚    â”‚
â”‚  â”‚  â”‚                                                                       â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  EVENT DESTINATIONS:                                                 â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  /topic/event/{eventId}                    â† Event updates           â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  /topic/event/{eventId}/rsvp               â† RSVP updates            â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  /user/{userId}/queue/events               â† User's event notifs     â”‚    â”‚    â”‚
â”‚  â”‚  â”‚                                                                       â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  EXISTING DESTINATIONS (unchanged):                                  â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  /topic/restaurant/{restaurantId}/reservations                       â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  /topic/ruser/{userId}/notifications                                 â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  /topic/customer/{userId}/notifications                              â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### RabbitMQ Queue Configuration

```java
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Aggiungere a RabbitMQConfig.java
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// ============ ðŸ†• CHAT QUEUE NAMES ============
public static final String QUEUE_CHAT_DIRECT = "notification.chat.direct";
public static final String QUEUE_CHAT_GROUP = "notification.chat.group";
public static final String QUEUE_CHAT_SUPPORT = "notification.chat.support";
public static final String QUEUE_CHAT_RESERVATION = "notification.chat.reservation";

// ============ ðŸ†• SOCIAL QUEUE NAMES ============
public static final String QUEUE_SOCIAL_FEED = "notification.social.feed";
public static final String QUEUE_SOCIAL_EVENTS = "notification.social.events";

// ============ ðŸ†• ROUTING KEYS ============
public static final String ROUTING_KEY_CHAT_DIRECT = "notification.chat.direct.*";
public static final String ROUTING_KEY_CHAT_GROUP = "notification.chat.group.*";
public static final String ROUTING_KEY_CHAT_SUPPORT = "notification.chat.support.*";
public static final String ROUTING_KEY_CHAT_RESERVATION = "notification.chat.reservation.*";
public static final String ROUTING_KEY_SOCIAL_FEED = "notification.social.feed.*";
public static final String ROUTING_KEY_SOCIAL_EVENTS = "notification.social.events.*";

// ============ ðŸ†• CHAT QUEUES & BINDINGS ============
@Bean
public Queue chatDirectQueue() {
    return new Queue(QUEUE_CHAT_DIRECT, true, false, false);
}

@Bean
public Queue chatGroupQueue() {
    return new Queue(QUEUE_CHAT_GROUP, true, false, false);
}

@Bean
public Queue chatSupportQueue() {
    return new Queue(QUEUE_CHAT_SUPPORT, true, false, false);
}

@Bean
public Queue chatReservationQueue() {
    return new Queue(QUEUE_CHAT_RESERVATION, true, false, false);
}

@Bean
public Binding chatDirectBinding(Queue chatDirectQueue, TopicExchange notificationsExchange) {
    return BindingBuilder.bind(chatDirectQueue)
            .to(notificationsExchange)
            .with(ROUTING_KEY_CHAT_DIRECT);
}

@Bean
public Binding chatGroupBinding(Queue chatGroupQueue, TopicExchange notificationsExchange) {
    return BindingBuilder.bind(chatGroupQueue)
            .to(notificationsExchange)
            .with(ROUTING_KEY_CHAT_GROUP);
}

@Bean
public Binding chatSupportBinding(Queue chatSupportQueue, TopicExchange notificationsExchange) {
    return BindingBuilder.bind(chatSupportQueue)
            .to(notificationsExchange)
            .with(ROUTING_KEY_CHAT_SUPPORT);
}

@Bean
public Binding chatReservationBinding(Queue chatReservationQueue, TopicExchange notificationsExchange) {
    return BindingBuilder.bind(chatReservationQueue)
            .to(notificationsExchange)
            .with(ROUTING_KEY_CHAT_RESERVATION);
}

// ============ ðŸ†• SOCIAL QUEUES & BINDINGS ============
@Bean
public Queue socialFeedQueue() {
    return new Queue(QUEUE_SOCIAL_FEED, true, false, false);
}

@Bean
public Queue socialEventsQueue() {
    return new Queue(QUEUE_SOCIAL_EVENTS, true, false, false);
}

@Bean
public Binding socialFeedBinding(Queue socialFeedQueue, TopicExchange notificationsExchange) {
    return BindingBuilder.bind(socialFeedQueue)
            .to(notificationsExchange)
            .with(ROUTING_KEY_SOCIAL_FEED);
}

@Bean
public Binding socialEventsBinding(Queue socialEventsQueue, TopicExchange notificationsExchange) {
    return BindingBuilder.bind(socialEventsQueue)
            .to(notificationsExchange)
            .with(ROUTING_KEY_SOCIAL_EVENTS);
}
```

### EventOutboxOrchestrator Routing Update

```java
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Aggiungere a EventOutboxOrchestrator.java - determineTargetQueue()
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * â­ DETERMINE TARGET QUEUE (EXTENDED FOR CHAT/SOCIAL)
 * 
 * Routes message to correct queue based on aggregateType + eventType.
 * 
 * ROUTING LOGIC:
 * 
 * CHAT EVENTS:
 * - CHAT_MESSAGE_SENT (DIRECT)      â†’ notification.chat.direct
 * - CHAT_MESSAGE_SENT (GROUP)       â†’ notification.chat.group
 * - CHAT_MESSAGE_SENT (RESERVATION) â†’ notification.chat.reservation
 * - SUPPORT_TICKET_*                â†’ notification.chat.support
 * 
 * SOCIAL EVENTS:
 * - SOCIAL_POST_*, SOCIAL_LIKE      â†’ notification.social.feed
 * - EVENT_*, EVENT_RSVP_*           â†’ notification.social.events
 * 
 * RESERVATION EVENTS (existing):
 * - RESERVATION_* from CUSTOMER     â†’ notification.restaurant.reservations
 * - RESERVATION_* from RESTAURANT   â†’ notification.customer
 */
private String determineTargetQueue(EventOutbox event) {
    String eventType = event.getEventType();
    String aggregateType = event.getAggregateType();
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ðŸ†• CHAT EVENT ROUTING
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if (eventType != null && eventType.startsWith("CHAT_")) {
        String conversationType = extractConversationType(event);
        
        return switch (conversationType) {
            case "DIRECT" -> "notification.chat.direct";
            case "GROUP" -> "notification.chat.group";
            case "RESERVATION" -> "notification.chat.reservation";
            case "SUPPORT" -> "notification.chat.support";
            default -> "notification.chat.direct";  // fallback
        };
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ðŸ†• SUPPORT TICKET ROUTING
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if (eventType != null && eventType.startsWith("SUPPORT_")) {
        return "notification.chat.support";
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ðŸ†• SOCIAL EVENT ROUTING
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if (eventType != null && eventType.startsWith("SOCIAL_")) {
        return "notification.social.feed";
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ðŸ†• RESTAURANT EVENT ROUTING
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if (eventType != null && eventType.startsWith("EVENT_")) {
        return "notification.social.events";
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // EXISTING RESERVATION ROUTING (unchanged)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if (isReservationEvent(eventType)) {
        String initiatedBy = extractInitiatedBy(event);
        if ("CUSTOMER".equalsIgnoreCase(initiatedBy)) {
            return "notification.restaurant.reservations";
        } else if ("RESTAURANT".equalsIgnoreCase(initiatedBy)) {
            return "notification.customer";
        }
        return "notification.restaurant.reservations";
    }
    
    // Default routing for other events
    return switch (aggregateType.toUpperCase()) {
        case "RESTAURANT" -> "notification.restaurant.user";
        case "CUSTOMER" -> "notification.customer";
        case "AGENCY" -> "notification.agency";
        case "ADMIN" -> "notification.admin";
        default -> throw new IllegalArgumentException("Unknown aggregateType: " + aggregateType);
    };
}

/**
 * Extract conversation type from event payload
 */
@SuppressWarnings("unchecked")
private String extractConversationType(EventOutbox event) {
    String payload = event.getPayload();
    if (payload != null && !payload.isEmpty()) {
        try {
            ObjectMapper mapper = new ObjectMapper();
            Map<String, Object> payloadMap = mapper.readValue(payload, Map.class);
            Object convType = payloadMap.get("conversationType");
            if (convType != null) {
                return convType.toString().toUpperCase();
            }
        } catch (Exception e) {
            log.debug("Could not extract conversationType from payload: {}", e.getMessage());
        }
    }
    return "DIRECT";  // default
}
```

### ChatOrchestrator (New)

```java
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// File: ChatOrchestrator.java
// Package: com.application.common.service.notification.orchestrator
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * â­ CHAT ORCHESTRATOR
 * 
 * Disaggregates chat messages to WebSocket destinations.
 * 
 * ROUTING BY CONVERSATION TYPE:
 * 
 * DIRECT (1:1):
 *   - Destination: /user/{recipientId}/queue/chat
 *   - Recipients: The OTHER participant (not sender)
 *   - Example: User 5 sends to User 10 â†’ /user/10/queue/chat
 * 
 * GROUP (N:N):
 *   - Destination: /topic/chat/{conversationId}
 *   - Recipients: ALL participants except sender
 *   - Example: Message in conv 42 â†’ /topic/chat/42
 * 
 * RESERVATION (linked to booking):
 *   - Destination: /topic/chat/{conversationId}
 *   - Recipients: Customer + Restaurant staff assigned to reservation
 *   - Example: Chat for reservation 123 â†’ /topic/chat/res-123
 * 
 * SUPPORT (ticket-based):
 *   - Destination: /topic/support/{ticketId}
 *   - Recipients: Requester + Assigned agent(s)
 *   - Also: /user/{agentId}/queue/support for agent notifications
 */
@Service
@Slf4j
@RequiredArgsConstructor
public class ChatOrchestrator extends NotificationOrchestrator<ChatNotification> {

    private final ChatParticipantDAO participantDAO;
    private final ChatNotificationDAO notificationDAO;

    @Override
    public List<ChatNotification> disaggregateAndProcess(Map<String, Object> message) {
        log.info("ðŸ’¬ ChatOrchestrator: starting disaggregation");
        
        List<ChatNotification> disaggregated = new ArrayList<>();
        
        String eventType = extractString(message, "event_type");
        String conversationType = extractString(message, "conversation_type");
        Long conversationId = extractLong(message, "conversation_id");
        Long senderId = extractLong(message, "sender_id");
        
        log.info("ðŸ“Š Chat Disaggregation: eventType={}, convType={}, convId={}, senderId={}", 
            eventType, conversationType, conversationId, senderId);
        
        // Load all participants except sender
        List<Long> recipientIds = loadRecipientsExceptSender(conversationId, senderId);
        
        // Determine WebSocket destination
        String destination = determineDestination(conversationType, conversationId, message);
        
        // Create notification for each recipient
        for (Long recipientId : recipientIds) {
            ChatNotification notification = createNotificationRecord(
                generateEventId(conversationId, recipientId),
                recipientId,
                "WEBSOCKET",
                message
            );
            notification.setDestination(destination);
            notification.setConversationId(conversationId);
            notification.setSenderId(senderId);
            
            disaggregated.add(notification);
        }
        
        log.info("âœ… Chat disaggregation complete: {} notifications, destination={}", 
            disaggregated.size(), destination);
        
        return disaggregated;
    }
    
    /**
     * Determines WebSocket destination based on conversation type
     */
    private String determineDestination(String conversationType, Long conversationId, Map<String, Object> message) {
        return switch (conversationType.toUpperCase()) {
            case "DIRECT" -> {
                // For direct messages, use user queue
                Long recipientId = extractLong(message, "recipient_id");
                yield "/user/" + recipientId + "/queue/chat";
            }
            case "GROUP" -> "/topic/chat/" + conversationId;
            case "RESERVATION" -> {
                Long reservationId = extractLong(message, "reservation_id");
                yield "/topic/chat/reservation/" + reservationId;
            }
            case "SUPPORT" -> {
                Long ticketId = extractLong(message, "ticket_id");
                yield "/topic/support/" + ticketId;
            }
            default -> "/topic/chat/" + conversationId;
        };
    }
    
    private List<Long> loadRecipientsExceptSender(Long conversationId, Long senderId) {
        return participantDAO.findByConversationId(conversationId)
            .stream()
            .filter(p -> !p.getUserId().equals(senderId))
            .filter(p -> p.getLeftAt() == null)  // Active participants only
            .map(ChatParticipant::getUserId)
            .collect(Collectors.toList());
    }
    
    @Override
    protected List<Long> loadRecipients(Map<String, Object> message) {
        Long conversationId = extractLong(message, "conversation_id");
        Long senderId = extractLong(message, "sender_id");
        return loadRecipientsExceptSender(conversationId, senderId);
    }
    
    @Override
    protected List<String> loadUserPreferences(Long userId) {
        // Chat always uses WEBSOCKET primarily
        return List.of("WEBSOCKET", "PUSH");
    }
    
    @Override
    protected Map<String, Object> loadGroupSettings(Map<String, Object> message) {
        return Map.of("enabled_channels", List.of("WEBSOCKET", "PUSH"));
    }
    
    @Override
    protected Map<String, Object> loadEventTypeRules(String eventType) {
        return Map.of(
            "mandatory", List.of("WEBSOCKET"),
            "optional", List.of("PUSH")
        );
    }
    
    @Override
    protected ChatNotification createNotificationRecord(
        String eventId, Long userId, String channel, Map<String, Object> message
    ) {
        return ChatNotification.builder()
            .eventId(eventId)
            .userId(userId)
            .channel(NotificationChannel.valueOf(channel))
            .status(DeliveryStatus.PENDING)
            .eventType(extractString(message, "event_type"))
            .title(generateTitle(message))
            .body(extractString(message, "content"))
            .build();
    }
    
    private String generateTitle(Map<String, Object> message) {
        String senderName = extractString(message, "sender_name");
        String conversationType = extractString(message, "conversation_type");
        
        return switch (conversationType.toUpperCase()) {
            case "DIRECT" -> "Messaggio da " + senderName;
            case "GROUP" -> senderName + " nel gruppo";
            case "RESERVATION" -> "Messaggio prenotazione";
            case "SUPPORT" -> "Aggiornamento ticket";
            default -> "Nuovo messaggio";
        };
    }
}
```

### SocialOrchestrator (New)

```java
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// File: SocialOrchestrator.java
// Package: com.application.common.service.notification.orchestrator
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * â­ SOCIAL ORCHESTRATOR
 * 
 * Disaggregates social events (posts, likes, comments, follows, events) to recipients.
 * 
 * ROUTING BY EVENT TYPE:
 * 
 * SOCIAL_POST_CREATED:
 *   - Notify: All followers of the author
 *   - Destination: /user/{followerId}/queue/social
 * 
 * SOCIAL_POST_LIKED:
 *   - Notify: Post author
 *   - Destination: /user/{authorId}/queue/social
 * 
 * SOCIAL_COMMENT_ADDED:
 *   - Notify: Post author + previous commenters + mentioned users
 *   - Destination: /user/{userId}/queue/social, /topic/social/post/{postId}
 * 
 * SOCIAL_USER_MENTIONED:
 *   - Notify: Mentioned user
 *   - Destination: /user/{mentionedId}/queue/social
 * 
 * SOCIAL_USER_FOLLOWED:
 *   - Notify: Followed user
 *   - Destination: /user/{followedId}/queue/social
 * 
 * EVENT_RSVP_CREATED:
 *   - Notify: Event organizer (restaurant)
 *   - Destination: /topic/event/{eventId}/rsvp
 * 
 * EVENT_REMINDER:
 *   - Notify: All RSVPs with status=GOING
 *   - Destination: /user/{userId}/queue/events
 */
@Service
@Slf4j
@RequiredArgsConstructor
public class SocialOrchestrator extends NotificationOrchestrator<SocialNotification> {

    private final SocialFollowDAO followDAO;
    private final SocialPostDAO postDAO;
    private final EventRSVPDAO rsvpDAO;
    private final SocialNotificationDAO notificationDAO;

    @Override
    public List<SocialNotification> disaggregateAndProcess(Map<String, Object> message) {
        log.info("ðŸ“± SocialOrchestrator: starting disaggregation");
        
        String eventType = extractString(message, "event_type");
        
        return switch (eventType) {
            case "SOCIAL_POST_CREATED" -> handlePostCreated(message);
            case "SOCIAL_POST_LIKED" -> handlePostLiked(message);
            case "SOCIAL_COMMENT_ADDED" -> handleCommentAdded(message);
            case "SOCIAL_USER_MENTIONED" -> handleUserMentioned(message);
            case "SOCIAL_USER_FOLLOWED", "SOCIAL_RESTAURANT_FOLLOWED" -> handleFollow(message);
            case "EVENT_RSVP_CREATED" -> handleEventRSVP(message);
            case "EVENT_REMINDER" -> handleEventReminder(message);
            default -> {
                log.warn("Unknown social event type: {}", eventType);
                yield new ArrayList<>();
            }
        };
    }
    
    private List<SocialNotification> handlePostCreated(Map<String, Object> message) {
        Long authorId = extractLong(message, "author_id");
        Long postId = extractLong(message, "post_id");
        
        // Get all followers of the author
        List<Long> followerIds = followDAO.findFollowerIdsByUserId(authorId);
        
        List<SocialNotification> notifications = new ArrayList<>();
        for (Long followerId : followerIds) {
            SocialNotification notification = createSocialNotification(
                followerId,
                "/user/" + followerId + "/queue/social",
                "Nuovo post",
                extractString(message, "author_name") + " ha pubblicato un nuovo post",
                message
            );
            notifications.add(notification);
        }
        
        log.info("âœ… POST_CREATED: {} followers notified for postId={}", followerIds.size(), postId);
        return notifications;
    }
    
    private List<SocialNotification> handlePostLiked(Map<String, Object> message) {
        Long postAuthorId = extractLong(message, "post_author_id");
        Long likerId = extractLong(message, "liker_id");
        
        // Don't notify if author liked their own post
        if (postAuthorId.equals(likerId)) {
            return new ArrayList<>();
        }
        
        SocialNotification notification = createSocialNotification(
            postAuthorId,
            "/user/" + postAuthorId + "/queue/social",
            "Nuovo like",
            extractString(message, "liker_name") + " ha messo like al tuo post",
            message
        );
        
        return List.of(notification);
    }
    
    private List<SocialNotification> handleCommentAdded(Map<String, Object> message) {
        Long postAuthorId = extractLong(message, "post_author_id");
        Long commenterId = extractLong(message, "commenter_id");
        Long postId = extractLong(message, "post_id");
        
        List<SocialNotification> notifications = new ArrayList<>();
        
        // Notify post author (if not the commenter)
        if (!postAuthorId.equals(commenterId)) {
            notifications.add(createSocialNotification(
                postAuthorId,
                "/user/" + postAuthorId + "/queue/social",
                "Nuovo commento",
                extractString(message, "commenter_name") + " ha commentato il tuo post",
                message
            ));
        }
        
        // Broadcast to post topic for real-time updates
        notifications.add(createSocialNotification(
            null,  // broadcast
            "/topic/social/post/" + postId,
            "Nuovo commento",
            extractString(message, "commenter_name") + " ha commentato",
            message
        ));
        
        return notifications;
    }
    
    private List<SocialNotification> handleUserMentioned(Map<String, Object> message) {
        Long mentionedUserId = extractLong(message, "mentioned_user_id");
        
        SocialNotification notification = createSocialNotification(
            mentionedUserId,
            "/user/" + mentionedUserId + "/queue/social",
            "Ti hanno menzionato",
            extractString(message, "author_name") + " ti ha menzionato in un post",
            message
        );
        
        return List.of(notification);
    }
    
    private List<SocialNotification> handleFollow(Map<String, Object> message) {
        Long followedId = extractLong(message, "followed_id");
        
        SocialNotification notification = createSocialNotification(
            followedId,
            "/user/" + followedId + "/queue/social",
            "Nuovo follower",
            extractString(message, "follower_name") + " ha iniziato a seguirti",
            message
        );
        
        return List.of(notification);
    }
    
    private List<SocialNotification> handleEventRSVP(Map<String, Object> message) {
        Long eventId = extractLong(message, "event_id");
        Long restaurantId = extractLong(message, "restaurant_id");
        
        // Broadcast to event topic
        SocialNotification notification = createSocialNotification(
            null,
            "/topic/event/" + eventId + "/rsvp",
            "Nuova partecipazione",
            extractString(message, "user_name") + " parteciperÃ  all'evento",
            message
        );
        
        // TODO: Also notify restaurant staff
        
        return List.of(notification);
    }
    
    private List<SocialNotification> handleEventReminder(Map<String, Object> message) {
        Long eventId = extractLong(message, "event_id");
        
        // Get all users with RSVP = GOING
        List<Long> attendeeIds = rsvpDAO.findUserIdsByEventIdAndStatus(eventId, "GOING");
        
        List<SocialNotification> notifications = new ArrayList<>();
        for (Long userId : attendeeIds) {
            notifications.add(createSocialNotification(
                userId,
                "/user/" + userId + "/queue/events",
                "Promemoria evento",
                "L'evento " + extractString(message, "event_title") + " Ã¨ domani!",
                message
            ));
        }
        
        return notifications;
    }
    
    private SocialNotification createSocialNotification(
        Long userId, String destination, String title, String body, Map<String, Object> message
    ) {
        return SocialNotification.builder()
            .eventId(generateEventId())
            .userId(userId)
            .destination(destination)
            .channel(NotificationChannel.WEBSOCKET)
            .status(DeliveryStatus.PENDING)
            .eventType(extractString(message, "event_type"))
            .title(title)
            .body(body)
            .properties(Map.of(
                "postId", extractString(message, "post_id"),
                "authorId", extractString(message, "author_id")
            ))
            .build();
    }
    
    // ... other required methods from NotificationOrchestrator
}
```

### WebSocketDestinationValidator Updates

```java
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Aggiungere a WebSocketDestinationValidator.java
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// ðŸ†• New prefixes
private static final String CHAT_PREFIX = "/topic/chat/";
private static final String SUPPORT_PREFIX = "/topic/support/";
private static final String SOCIAL_PREFIX = "/topic/social/";
private static final String EVENT_PREFIX = "/topic/event/";

/**
 * Extended canAccess() for Chat/Social/Events
 */
public boolean canAccess(String destination, String userType, Long userId, Long restaurantId, Long agencyId) {
    // ... existing code ...
    
    // ðŸ†• CHAT DESTINATIONS
    if (destination.startsWith(CHAT_PREFIX)) {
        return validateChatAccess(destination, userId);
    }
    
    // ðŸ†• SUPPORT DESTINATIONS
    if (destination.startsWith(SUPPORT_PREFIX)) {
        return validateSupportAccess(destination, userType, userId);
    }
    
    // ðŸ†• SOCIAL DESTINATIONS
    if (destination.startsWith(SOCIAL_PREFIX)) {
        return validateSocialAccess(destination, userType, userId, restaurantId);
    }
    
    // ðŸ†• EVENT DESTINATIONS
    if (destination.startsWith(EVENT_PREFIX)) {
        return validateEventAccess(destination, userType, userId);
    }
    
    // ... existing code ...
}

/**
 * Validate chat conversation access
 * /topic/chat/{conversationId}
 * 
 * Security: User must be a participant in the conversation
 */
private boolean validateChatAccess(String destination, Long userId) {
    // Extract conversation ID
    String[] parts = destination.substring(CHAT_PREFIX.length()).split("/");
    if (parts.length < 1) {
        return false;
    }
    
    try {
        Long conversationId = Long.parseLong(parts[0]);
        
        // TODO: Verify user is participant via ChatParticipantDAO
        // return chatParticipantDAO.existsByConversationIdAndUserId(conversationId, userId);
        
        log.debug("âœ… Chat access check: convId={}, userId={}", conversationId, userId);
        return true;  // Placeholder - implement DB check
        
    } catch (NumberFormatException e) {
        return false;
    }
}

/**
 * Validate support ticket access
 * /topic/support/{ticketId}
 * 
 * Security: User must be requester or assigned agent
 */
private boolean validateSupportAccess(String destination, String userType, Long userId) {
    String[] parts = destination.substring(SUPPORT_PREFIX.length()).split("/");
    if (parts.length < 1) {
        return false;
    }
    
    try {
        Long ticketId = Long.parseLong(parts[0]);
        
        // Admins can access all tickets
        if ("admin".equals(userType)) {
            return true;
        }
        
        // TODO: Verify user is requester or assigned agent
        // return supportTicketDAO.canUserAccessTicket(ticketId, userId);
        
        log.debug("âœ… Support access check: ticketId={}, userId={}", ticketId, userId);
        return true;  // Placeholder
        
    } catch (NumberFormatException e) {
        return false;
    }
}

/**
 * Validate social topic access
 * /topic/social/restaurant/{restaurantId}
 * /topic/social/post/{postId}
 */
private boolean validateSocialAccess(String destination, String userType, Long userId, Long restaurantId) {
    // Public social content - allow all authenticated users
    return userId != null;
}

/**
 * Validate event topic access
 * /topic/event/{eventId}
 * /topic/event/{eventId}/rsvp
 */
private boolean validateEventAccess(String destination, String userType, Long userId) {
    // Public events - allow all authenticated users
    return userId != null;
}
```

### RabbitMQ Listener Routing Table

| Event Type | RabbitMQ Queue | Orchestrator | WebSocket Destination |
|------------|----------------|--------------|----------------------|
| **CHAT** | | | |
| CHAT_MESSAGE_SENT (DIRECT) | notification.chat.direct | ChatOrchestrator | /user/{userId}/queue/chat |
| CHAT_MESSAGE_SENT (GROUP) | notification.chat.group | ChatOrchestrator | /topic/chat/{convId} |
| CHAT_MESSAGE_SENT (RESERVATION) | notification.chat.reservation | ChatOrchestrator | /topic/chat/reservation/{resId} |
| CHAT_TYPING_STARTED | notification.chat.* | (direct WebSocket) | /topic/chat/{convId}/typing |
| **SUPPORT** | | | |
| SUPPORT_TICKET_CREATED | notification.chat.support | ChatOrchestrator | /user/{userId}/queue/support |
| SUPPORT_MESSAGE_ADDED | notification.chat.support | ChatOrchestrator | /topic/support/{ticketId} |
| SUPPORT_TICKET_ASSIGNED | notification.chat.support | ChatOrchestrator | /user/{agentId}/queue/support |
| **SOCIAL** | | | |
| SOCIAL_POST_CREATED | notification.social.feed | SocialOrchestrator | /user/{followerId}/queue/social |
| SOCIAL_POST_LIKED | notification.social.feed | SocialOrchestrator | /user/{authorId}/queue/social |
| SOCIAL_COMMENT_ADDED | notification.social.feed | SocialOrchestrator | /topic/social/post/{postId} |
| SOCIAL_USER_FOLLOWED | notification.social.feed | SocialOrchestrator | /user/{followedId}/queue/social |
| **EVENTS** | | | |
| EVENT_PUBLISHED | notification.social.events | SocialOrchestrator | /topic/event/{eventId} |
| EVENT_RSVP_CREATED | notification.social.events | SocialOrchestrator | /topic/event/{eventId}/rsvp |
| EVENT_REMINDER | notification.social.events | SocialOrchestrator | /user/{userId}/queue/events |
| **RESERVATION (existing)** | | | |
| RESERVATION_REQUESTED | notification.restaurant.reservations | RestaurantTeamOrchestrator | /topic/restaurant/{restId}/reservations |
| RESERVATION_ACCEPTED | notification.customer | CustomerOrchestrator | /topic/customer/{custId}/notifications |

### Chat Notification Listeners

```java
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// File: ChatDirectNotificationListener.java
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

@Service
@Slf4j
@RequiredArgsConstructor
public class ChatDirectNotificationListener {

    private final ChatOrchestrator chatOrchestrator;
    private final ChatNotificationDAO notificationDAO;
    private final SimpMessagingTemplate messagingTemplate;

    @RabbitListener(queues = "notification.chat.direct", ackMode = "MANUAL")
    public void handleChatDirectMessage(Map<String, Object> message, Channel channel, 
                                        @Header(AmqpHeaders.DELIVERY_TAG) long tag) {
        try {
            log.info("ðŸ’¬ Received DIRECT chat message: {}", message.get("event_id"));
            
            // Disaggregate
            List<ChatNotification> notifications = chatOrchestrator.disaggregateAndProcess(message);
            
            // Save to DB
            notificationDAO.saveAll(notifications);
            
            // Send via WebSocket
            for (ChatNotification n : notifications) {
                messagingTemplate.convertAndSend(n.getDestination(), n.toDTO());
                n.setWebSocketDelivered(true);
            }
            
            notificationDAO.saveAll(notifications);
            channel.basicAck(tag, false);
            
        } catch (Exception e) {
            log.error("Error processing chat direct message", e);
            try {
                channel.basicNack(tag, false, true);
            } catch (IOException ex) {
                log.error("Failed to NACK message", ex);
            }
        }
    }
}

// Similar listeners for:
// - ChatGroupNotificationListener (queue: notification.chat.group)
// - ChatSupportNotificationListener (queue: notification.chat.support)
// - SocialFeedNotificationListener (queue: notification.social.feed)
// - SocialEventsNotificationListener (queue: notification.social.events)
```

---

## ï¿½ðŸ”„ EventType per Chat, Support, Social & Events

```java
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CHAT EVENTS (da aggiungere a EventType.java)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€â”€â”€â”€â”€â”€ CHAT CONVERSATION EVENTS â”€â”€â”€â”€â”€â”€â”€

/**
 * Nuova conversazione creata.
 * Payload: conversationId, conversationType, createdById, participantIds[]
 */
CHAT_CONVERSATION_CREATED("chat.conversation_created"),

/**
 * Utente aggiunto a conversazione esistente.
 * Payload: conversationId, addedUserId, addedByUserId
 */
CHAT_PARTICIPANT_ADDED("chat.participant_added"),

/**
 * Utente rimosso da conversazione.
 * Payload: conversationId, removedUserId, removedByUserId
 */
CHAT_PARTICIPANT_REMOVED("chat.participant_removed"),

/**
 * Utente ha abbandonato conversazione (volontariamente).
 * Payload: conversationId, userId
 */
CHAT_PARTICIPANT_LEFT("chat.participant_left"),

/**
 * Conversazione archiviata.
 * Payload: conversationId, archivedByUserId
 */
CHAT_CONVERSATION_ARCHIVED("chat.conversation_archived"),

// â”€â”€â”€â”€â”€â”€â”€ CHAT MESSAGE EVENTS â”€â”€â”€â”€â”€â”€â”€

/**
 * â­ Nuovo messaggio inviato.
 * Notifica: TUTTI i partecipanti tranne il sender
 * Payload: conversationId, messageId, senderId, content, messageType
 */
CHAT_MESSAGE_SENT("chat.message_sent"),

/**
 * Messaggio modificato.
 * Payload: conversationId, messageId, editorId, oldContent, newContent
 */
CHAT_MESSAGE_EDITED("chat.message_edited"),

/**
 * Messaggio eliminato.
 * Payload: conversationId, messageId, deletedByUserId
 */
CHAT_MESSAGE_DELETED("chat.message_deleted"),

/**
 * Utente sta scrivendo (typing indicator).
 * Payload: conversationId, userId (no persistence, WebSocket only)
 */
CHAT_USER_TYPING("chat.user_typing"),

/**
 * Messaggi marcati come letti.
 * Payload: conversationId, userId, lastReadMessageId
 */
CHAT_MESSAGES_READ("chat.messages_read"),

// â”€â”€â”€â”€â”€â”€â”€ SUPPORT TICKET EVENTS â”€â”€â”€â”€â”€â”€â”€

/**
 * Nuovo ticket di supporto aperto.
 * Payload: ticketId, ticketNumber, requesterId, category, subject
 */
SUPPORT_TICKET_CREATED("support.ticket_created"),

/**
 * Ticket assegnato ad un agente.
 * Payload: ticketId, assignedAgentId, previousAgentId
 */
SUPPORT_TICKET_ASSIGNED("support.ticket_assigned"),

/**
 * Stato ticket cambiato.
 * Payload: ticketId, oldStatus, newStatus, changedByUserId
 */
SUPPORT_TICKET_STATUS_CHANGED("support.ticket_status_changed"),

/**
 * Nuovo messaggio nel ticket.
 * Payload: ticketId, messageId, senderId, senderType
 */
SUPPORT_TICKET_MESSAGE_SENT("support.ticket_message_sent"),

/**
 * Bot ha risposto automaticamente.
 * Payload: ticketId, messageId, matchedFaqId, confidence
 */
SUPPORT_BOT_REPLIED("support.bot_replied"),

/**
 * Ticket escalato (da bot a umano, o da L1 a L2).
 * Payload: ticketId, escalatedFromId, escalatedToId, reason
 */
SUPPORT_TICKET_ESCALATED("support.ticket_escalated"),

/**
 * Ticket risolto.
 * Payload: ticketId, resolvedByUserId, resolutionSummary
 */
SUPPORT_TICKET_RESOLVED("support.ticket_resolved"),

/**
 * Ticket chiuso.
 * Payload: ticketId, closedByUserId, closedBySystem
 */
SUPPORT_TICKET_CLOSED("support.ticket_closed"),

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ðŸ†• SOCIAL EVENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€â”€â”€â”€â”€â”€ POST EVENTS â”€â”€â”€â”€â”€â”€â”€

/**
 * â­ Nuovo post creato (con foto/video).
 * Notifica: Followers del creator + Restaurant taggato
 * Payload: postId, authorId, restaurantId, reservationId, postType, mediaCount
 */
SOCIAL_POST_CREATED("social.post_created"),

/**
 * Post modificato.
 * Payload: postId, authorId, changedFields[]
 */
SOCIAL_POST_EDITED("social.post_edited"),

/**
 * Post eliminato.
 * Payload: postId, authorId, deletedByUserId
 */
SOCIAL_POST_DELETED("social.post_deleted"),

/**
 * Story creata (24h expiry).
 * Notifica: Followers
 * Payload: storyId, authorId, restaurantId, expiresAt
 */
SOCIAL_STORY_CREATED("social.story_created"),

/**
 * Story scaduta (auto-archiviata).
 * Payload: storyId, authorId
 */
SOCIAL_STORY_EXPIRED("social.story_expired"),

// â”€â”€â”€â”€â”€â”€â”€ INTERACTION EVENTS â”€â”€â”€â”€â”€â”€â”€

/**
 * â­ Like su post.
 * Notifica: Autore del post
 * Payload: postId, userId, reactionType
 */
SOCIAL_POST_LIKED("social.post_liked"),

/**
 * Unlike su post (rimozione like).
 * Payload: postId, userId
 */
SOCIAL_POST_UNLIKED("social.post_unliked"),

/**
 * â­ Commento su post.
 * Notifica: Autore del post + utenti menzionati
 * Payload: postId, commentId, authorId, parentCommentId, mentionedUserIds[]
 */
SOCIAL_COMMENT_CREATED("social.comment_created"),

/**
 * Commento modificato.
 * Payload: commentId, authorId
 */
SOCIAL_COMMENT_EDITED("social.comment_edited"),

/**
 * Commento eliminato.
 * Payload: commentId, deletedByUserId
 */
SOCIAL_COMMENT_DELETED("social.comment_deleted"),

/**
 * Like su commento.
 * Notifica: Autore del commento
 * Payload: commentId, userId
 */
SOCIAL_COMMENT_LIKED("social.comment_liked"),

/**
 * Post condiviso.
 * Notifica: Autore originale
 * Payload: postId, sharedByUserId, shareDestination
 */
SOCIAL_POST_SHARED("social.post_shared"),

/**
 * Post salvato nella collection.
 * Payload: postId, userId, collectionName
 */
SOCIAL_POST_SAVED("social.post_saved"),

// â”€â”€â”€â”€â”€â”€â”€ FOLLOW EVENTS â”€â”€â”€â”€â”€â”€â”€

/**
 * â­ Nuovo follower (utente segue utente).
 * Notifica: Utente seguito
 * Payload: followerId, followedUserId
 */
SOCIAL_USER_FOLLOWED("social.user_followed"),

/**
 * Unfollow utente.
 * Payload: followerId, unfollowedUserId
 */
SOCIAL_USER_UNFOLLOWED("social.user_unfollowed"),

/**
 * â­ Nuovo follower ristorante.
 * Notifica: Restaurant owner/manager
 * Payload: followerId, restaurantId
 */
SOCIAL_RESTAURANT_FOLLOWED("social.restaurant_followed"),

/**
 * Unfollow ristorante.
 * Payload: followerId, restaurantId
 */
SOCIAL_RESTAURANT_UNFOLLOWED("social.restaurant_unfollowed"),

// â”€â”€â”€â”€â”€â”€â”€ MENTION EVENTS â”€â”€â”€â”€â”€â”€â”€

/**
 * â­ Utente menzionato in post/commento.
 * Notifica: Utente menzionato
 * Payload: postId, commentId, mentionedUserId, mentionedByUserId
 */
SOCIAL_USER_MENTIONED("social.user_mentioned"),

// â”€â”€â”€â”€â”€â”€â”€ REVIEW EVENTS â”€â”€â”€â”€â”€â”€â”€

/**
 * â­ Nuova recensione verificata (da prenotazione completata).
 * Notifica: Restaurant owner/manager
 * Payload: reviewId, authorId, restaurantId, reservationId, rating
 */
SOCIAL_REVIEW_CREATED("social.review_created"),

/**
 * Risposta del ristorante alla recensione.
 * Notifica: Autore recensione
 * Payload: reviewId, restaurantId, replyText
 */
SOCIAL_REVIEW_REPLIED("social.review_replied"),

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ðŸ†• RESTAURANT EVENT EVENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * â­ Nuovo evento ristorante pubblicato.
 * Notifica: Followers del ristorante + Clienti frequenti
 * Payload: eventId, restaurantId, title, eventDate, category
 */
RESTAURANT_EVENT_PUBLISHED("restaurant.event_published"),

/**
 * Evento modificato.
 * Notifica: Utenti con RSVP
 * Payload: eventId, changedFields[]
 */
RESTAURANT_EVENT_UPDATED("restaurant.event_updated"),

/**
 * Evento cancellato.
 * Notifica: Tutti gli utenti con RSVP
 * Payload: eventId, restaurantId, cancellationReason
 */
RESTAURANT_EVENT_CANCELLED("restaurant.event_cancelled"),

/**
 * â­ Nuovo RSVP all'evento.
 * Notifica: Restaurant owner + Event creator
 * Payload: eventId, userId, rsvpStatus, partySize
 */
RESTAURANT_EVENT_RSVP_CREATED("restaurant.event_rsvp_created"),

/**
 * RSVP modificato (es. INTERESTED â†’ GOING).
 * Payload: eventId, userId, oldStatus, newStatus
 */
RESTAURANT_EVENT_RSVP_UPDATED("restaurant.event_rsvp_updated"),

/**
 * RSVP cancellato.
 * Payload: eventId, userId
 */
RESTAURANT_EVENT_RSVP_CANCELLED("restaurant.event_rsvp_cancelled"),

/**
 * Reminder evento (24h/1h prima).
 * Notifica: Utenti con RSVP GOING
 * Payload: eventId, reminderType (24H, 1H)
 */
RESTAURANT_EVENT_REMINDER("restaurant.event_reminder"),

/**
 * Evento quasi al completo (80% capacity).
 * Notifica: Utenti con RSVP INTERESTED
 * Payload: eventId, remainingSpots
 */
RESTAURANT_EVENT_ALMOST_FULL("restaurant.event_almost_full"),

/**
 * Evento sold out.
 * Payload: eventId
 */
RESTAURANT_EVENT_SOLD_OUT("restaurant.event_sold_out"),
```

---

## ðŸ”€ Sequence Diagram - Chat Message Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚     â”‚ ChatControllerâ”‚     â”‚ ChatService â”‚     â”‚ EventOutboxDAO   â”‚
â”‚ (Sender) â”‚     â”‚              â”‚     â”‚             â”‚     â”‚                  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                   â”‚                    â”‚                     â”‚
     â”‚ POST /chat/{id}/messages              â”‚                     â”‚
     â”‚ {content: "Ciao!"}â”‚                    â”‚                     â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                     â”‚
     â”‚                   â”‚                    â”‚                     â”‚
     â”‚                   â”‚ sendMessage(convId,â”‚senderId, content)   â”‚
     â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚
     â”‚                   â”‚                    â”‚                     â”‚
     â”‚                   â”‚                    â”‚ 1. Validate sender  â”‚
     â”‚                   â”‚                    â”‚    is participant   â”‚
     â”‚                   â”‚                    â”‚                     â”‚
     â”‚                   â”‚                    â”‚ 2. Save ChatMessage â”‚
     â”‚                   â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”             â”‚
     â”‚                   â”‚                    â”‚       â”‚ INSERT      â”‚
     â”‚                   â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”˜             â”‚
     â”‚                   â”‚                    â”‚                     â”‚
     â”‚                   â”‚                    â”‚ 3. Create EventOutbox
     â”‚                   â”‚                    â”‚    CHAT_MESSAGE_SENTâ”‚
     â”‚                   â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                   â”‚                    â”‚                     â”‚ INSERT
     â”‚                   â”‚                    â”‚                     â”‚
     â”‚                   â”‚ ChatMessageDTO     â”‚                     â”‚
     â”‚                   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                     â”‚
     â”‚                   â”‚                    â”‚                     â”‚
     â”‚ 200 OK            â”‚                    â”‚                     â”‚
     â”‚ {messageId: 123}  â”‚                    â”‚                     â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚                     â”‚
     â”‚                   â”‚                    â”‚                     â”‚
```

### Notification Disaggregation Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚EventOutboxPoller â”‚     â”‚ ChatOrchestrator â”‚     â”‚ChatNotificationDAOâ”‚
â”‚  (Scheduler)     â”‚     â”‚                  â”‚     â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                        â”‚                        â”‚
         â”‚ Poll PENDING events    â”‚                        â”‚
         â”‚ event_type=CHAT_MESSAGE_SENT                    â”‚
         â”‚                        â”‚                        â”‚
         â”‚                        â”‚                        â”‚
         â”‚ disaggregateAndProcess(message)                 â”‚
         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚
         â”‚                        â”‚                        â”‚
         â”‚                        â”‚ 1. Load conversation   â”‚
         â”‚                        â”‚    participants        â”‚
         â”‚                        â”‚â”€â”€â”€â”€â”€â”€â”€â”                â”‚
         â”‚                        â”‚       â”‚ SELECT         â”‚
         â”‚                        â”‚<â”€â”€â”€â”€â”€â”€â”˜ chat_participant
         â”‚                        â”‚                        â”‚
         â”‚                        â”‚ 2. Filter: exclude sender
         â”‚                        â”‚    recipients = [P1, P2, P3] - sender
         â”‚                        â”‚                        â”‚
         â”‚                        â”‚ FOR EACH recipient:    â”‚
         â”‚                        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
         â”‚                        â”‚ 3. Load user preferencesâ”‚
         â”‚                        â”‚ 4. Calculate channels  â”‚
         â”‚                        â”‚    [WEBSOCKET, PUSH]   â”‚
         â”‚                        â”‚                        â”‚
         â”‚                        â”‚ 5. FOR EACH channel:   â”‚
         â”‚                        â”‚    Create notification â”‚
         â”‚                        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
         â”‚                        â”‚                        â”‚ INSERT
         â”‚                        â”‚                        â”‚ notification
         â”‚                        â”‚                        â”‚
         â”‚                        â”‚                        â”‚
         â”‚ List<ChatNotification> â”‚                        â”‚
         â”‚ (N participants x M channels)                   â”‚
         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚
         â”‚                        â”‚                        â”‚
         â”‚ Mark EventOutbox PROCESSED                      â”‚
         â”‚                        â”‚                        â”‚
```

---

## ðŸ¤– Bot Integration Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           BOT SUPPORT SYSTEM                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                        BOT TIERS (Per User Type)                     â”‚    â”‚
â”‚  â”‚                                                                       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚    â”‚
â”‚  â”‚  â”‚ CUSTOMER BOT  â”‚  â”‚RESTAURANT BOT â”‚  â”‚  AGENCY BOT   â”‚            â”‚    â”‚
â”‚  â”‚  â”‚               â”‚  â”‚               â”‚  â”‚               â”‚            â”‚    â”‚
â”‚  â”‚  â”‚ FAQ:          â”‚  â”‚ FAQ:          â”‚  â”‚ FAQ:          â”‚            â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ Prenotazioniâ”‚  â”‚ â€¢ Setup Menu  â”‚  â”‚ â€¢ Multi-rest  â”‚            â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ Pagamenti   â”‚  â”‚ â€¢ Orari       â”‚  â”‚ â€¢ Reportisticaâ”‚            â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ Allergie    â”‚  â”‚ â€¢ Staff       â”‚  â”‚ â€¢ Contratti   â”‚            â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ Politiche   â”‚  â”‚ â€¢ Clienti VIP â”‚  â”‚ â€¢ Supporto    â”‚            â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                    â”‚                                         â”‚
â”‚                                    â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      PROCESSING PIPELINE                             â”‚    â”‚
â”‚  â”‚                                                                       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚    â”‚
â”‚  â”‚  â”‚ Receive  â”‚â”€â”€â”€>â”‚ Classify â”‚â”€â”€â”€>â”‚  Match   â”‚â”€â”€â”€>â”‚ Respond  â”‚      â”‚    â”‚
â”‚  â”‚  â”‚ Message  â”‚    â”‚ Intent   â”‚    â”‚   FAQ    â”‚    â”‚ or       â”‚      â”‚    â”‚
â”‚  â”‚  â”‚          â”‚    â”‚          â”‚    â”‚          â”‚    â”‚ Escalate â”‚      â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚    â”‚
â”‚  â”‚                                                                       â”‚    â”‚
â”‚  â”‚  Keywords      Confidence      Threshold         Action              â”‚    â”‚
â”‚  â”‚  Extraction    Score           Check             Selection           â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚    â”‚
â”‚  â”‚  "prenotare"   0.85           >0.7 â†’ Reply       BOT_REPLIED         â”‚    â”‚
â”‚  â”‚  "cancellare"  0.60           <0.7 â†’ Escalate    TICKET_ESCALATED    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      FUTURE: AI INTEGRATION                          â”‚    â”‚
â”‚  â”‚                                                                       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚                    OpenAI / Local LLM                          â”‚   â”‚    â”‚
â”‚  â”‚  â”‚                                                                 â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ RAG (Retrieval Augmented Generation) con FAQ database       â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Intent classification con fine-tuned model                  â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Sentiment analysis per prioritÃ  ticket                      â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Generazione risposte personalizzate                         â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Bot Processing Flow

```java
// SupportBotService.java (pseudocode)

public BotResponse processMessage(SupportTicket ticket, String message) {
    
    // 1. Determine user type
    UserType userType = getUserType(ticket.getRequester());
    
    // 2. Load relevant FAQs
    List<SupportFAQ> faqs = faqDAO.findByUserTypeAndCategory(
        userType, ticket.getCategory()
    );
    
    // 3. Calculate similarity scores
    List<FAQMatch> matches = faqs.stream()
        .map(faq -> new FAQMatch(faq, calculateSimilarity(message, faq)))
        .sorted(byConfidenceDesc())
        .collect(toList());
    
    // 4. Check threshold
    FAQMatch bestMatch = matches.get(0);
    
    if (bestMatch.getConfidence() >= BOT_CONFIDENCE_THRESHOLD) {
        // Auto-reply
        return BotResponse.builder()
            .action(Action.REPLY)
            .content(bestMatch.getFaq().getAnswer())
            .matchedFaqId(bestMatch.getFaq().getId())
            .confidence(bestMatch.getConfidence())
            .build();
    } else {
        // Escalate to human
        return BotResponse.builder()
            .action(Action.ESCALATE)
            .reason("Low confidence: " + bestMatch.getConfidence())
            .suggestedAgentId(findAvailableAgent())
            .build();
    }
}
```

---

## ðŸ” Security & Access Control

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ACCESS CONTROL MATRIX                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  CHAT CONVERSATION ACCESS:                                                   â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                 â”‚ CUSTOMERâ”‚REST.USERâ”‚AGENCY   â”‚ ADMIN   â”‚ SUPPORT  â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚ View own conv.  â”‚   âœ…    â”‚   âœ…    â”‚   âœ…    â”‚   âœ…    â”‚    âœ…    â”‚     â”‚
â”‚  â”‚ Create DIRECT   â”‚   âœ…    â”‚   âœ…    â”‚   âœ…    â”‚   âœ…    â”‚    âœ…    â”‚     â”‚
â”‚  â”‚ Create GROUP    â”‚   âŒ    â”‚   âœ…    â”‚   âœ…    â”‚   âœ…    â”‚    âŒ    â”‚     â”‚
â”‚  â”‚ Add participant â”‚   âŒ    â”‚   âœ…*   â”‚   âœ…*   â”‚   âœ…    â”‚    âŒ    â”‚     â”‚
â”‚  â”‚ View all conv.  â”‚   âŒ    â”‚   âŒ    â”‚   âŒ    â”‚   âœ…    â”‚    âŒ    â”‚     â”‚
â”‚  â”‚ Archive conv.   â”‚   âŒ    â”‚   âœ…*   â”‚   âœ…*   â”‚   âœ…    â”‚    âŒ    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â”‚  * = only for own restaurant/agency conversations                            â”‚
â”‚                                                                              â”‚
â”‚  SUPPORT TICKET ACCESS:                                                      â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                       â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                 â”‚ CUSTOMERâ”‚REST.USERâ”‚AGENCY   â”‚ ADMIN   â”‚ SUPPORT  â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚ Create ticket   â”‚   âœ…    â”‚   âœ…    â”‚   âœ…    â”‚   âœ…    â”‚    âŒ    â”‚     â”‚
â”‚  â”‚ View own ticket â”‚   âœ…    â”‚   âœ…    â”‚   âœ…    â”‚   âœ…    â”‚    âœ…    â”‚     â”‚
â”‚  â”‚ Assign agent    â”‚   âŒ    â”‚   âŒ    â”‚   âŒ    â”‚   âœ…    â”‚    âœ…    â”‚     â”‚
â”‚  â”‚ Close ticket    â”‚   âœ…*   â”‚   âœ…*   â”‚   âœ…*   â”‚   âœ…    â”‚    âœ…    â”‚     â”‚
â”‚  â”‚ View all ticketsâ”‚   âŒ    â”‚   âŒ    â”‚   âŒ    â”‚   âœ…    â”‚    âœ…    â”‚     â”‚
â”‚  â”‚ Internal notes  â”‚   âŒ    â”‚   âŒ    â”‚   âŒ    â”‚   âœ…    â”‚    âœ…    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â”‚  * = only own tickets                                                        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“Š Audit Trail

```java
// Da aggiungere ad AuditService.java

// â”€â”€â”€â”€â”€â”€â”€ CHAT AUDIT â”€â”€â”€â”€â”€â”€â”€

public void auditChatConversationCreated(Long conversationId, Long createdById, 
        ConversationType type, List<Long> participantIds) {
    // Log: WHO created WHAT type of conversation with WHOM
}

public void auditChatMessageSent(Long conversationId, Long messageId, 
        Long senderId, String contentPreview) {
    // Log: WHO sent message WHERE (preview for compliance, not full content)
}

public void auditChatParticipantAdded(Long conversationId, Long addedUserId, 
        Long addedByUserId) {
    // Log: WHO added WHOM to conversation
}

// â”€â”€â”€â”€â”€â”€â”€ SUPPORT AUDIT â”€â”€â”€â”€â”€â”€â”€

public void auditSupportTicketCreated(Long ticketId, String ticketNumber, 
        Long requesterId, String category) {
    // Log: WHO created ticket for WHAT
}

public void auditSupportTicketAssigned(Long ticketId, Long agentId, 
        Long assignedById) {
    // Log: WHO assigned ticket to WHOM
}

public void auditSupportTicketEscalated(Long ticketId, Long fromAgentId, 
        Long toAgentId, String reason) {
    // Log: Escalation chain
}

public void auditSupportTicketResolved(Long ticketId, Long resolvedById, 
        String resolutionSummary) {
    // Log: WHO resolved with WHAT solution
}
```

---

## ðŸ“± API Endpoints Summary

### Chat API (`/api/v1/chat`)

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/conversations` | Crea nuova conversazione |
| GET | `/conversations` | Lista conversazioni utente |
| GET | `/conversations/{id}` | Dettaglio conversazione |
| POST | `/conversations/{id}/messages` | Invia messaggio |
| GET | `/conversations/{id}/messages` | Lista messaggi (paginata) |
| PUT | `/conversations/{id}/messages/{msgId}` | Modifica messaggio |
| DELETE | `/conversations/{id}/messages/{msgId}` | Elimina messaggio |
| POST | `/conversations/{id}/participants` | Aggiungi partecipante |
| DELETE | `/conversations/{id}/participants/{userId}` | Rimuovi partecipante |
| POST | `/conversations/{id}/read` | Marca come letto |
| POST | `/conversations/{id}/archive` | Archivia conversazione |

### Support API (`/api/v1/support`)

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/tickets` | Apri nuovo ticket |
| GET | `/tickets` | Lista ticket utente |
| GET | `/tickets/{id}` | Dettaglio ticket |
| POST | `/tickets/{id}/messages` | Aggiungi messaggio |
| GET | `/tickets/{id}/messages` | Lista messaggi ticket |
| PUT | `/tickets/{id}/status` | Cambia stato |
| PUT | `/tickets/{id}/assign` | Assegna agente (admin) |
| POST | `/tickets/{id}/escalate` | Escala ticket |
| GET | `/faq` | Lista FAQ per user type |
| GET | `/faq/search?q=` | Cerca in FAQ |

### Social API (`/api/v1/social`)

| Method | Endpoint | Description |
|--------|----------|-------------|
| **POSTS** | | |
| POST | `/posts` | Crea nuovo post |
| GET | `/posts` | Feed posts (seguiti + suggeriti) |
| GET | `/posts/{id}` | Dettaglio post |
| PUT | `/posts/{id}` | Modifica post |
| DELETE | `/posts/{id}` | Elimina post |
| POST | `/posts/{id}/like` | Metti like |
| DELETE | `/posts/{id}/like` | Rimuovi like |
| GET | `/posts/{id}/likes` | Lista utenti che hanno messo like |
| POST | `/posts/{id}/comments` | Aggiungi commento |
| GET | `/posts/{id}/comments` | Lista commenti (paginata) |
| DELETE | `/posts/{id}/comments/{commentId}` | Elimina commento |
| GET | `/posts/restaurant/{restaurantId}` | Posts di un ristorante |
| GET | `/posts/user/{userId}` | Posts di un utente |
| GET | `/posts/reservation/{reservationId}` | Posts legati a prenotazione |
| **STORIES** | | |
| POST | `/stories` | Crea nuova story |
| GET | `/stories` | Stories dei seguiti (24h) |
| GET | `/stories/{id}` | Visualizza story |
| DELETE | `/stories/{id}` | Elimina story |
| GET | `/stories/restaurant/{restaurantId}` | Stories di un ristorante |
| GET | `/stories/user/{userId}` | Stories di un utente |
| POST | `/stories/{id}/view` | Marca come vista |
| GET | `/stories/{id}/viewers` | Lista visualizzatori (solo owner) |
| **FOLLOW** | | |
| POST | `/users/{userId}/follow` | Segui utente |
| DELETE | `/users/{userId}/follow` | Smetti di seguire utente |
| GET | `/users/{userId}/followers` | Lista followers |
| GET | `/users/{userId}/following` | Lista seguiti |
| POST | `/restaurants/{restaurantId}/follow` | Segui ristorante |
| DELETE | `/restaurants/{restaurantId}/follow` | Smetti di seguire ristorante |
| GET | `/restaurants/{restaurantId}/followers` | Lista followers ristorante |
| **DISCOVER** | | |
| GET | `/discover/trending` | Posts popolari |
| GET | `/discover/nearby` | Posts vicini (geo) |
| GET | `/discover/restaurants` | Ristoranti suggeriti |
| GET | `/search?q=` | Cerca posts/utenti/ristoranti |

### Events API (`/api/v1/events`)

| Method | Endpoint | Description |
|--------|----------|-------------|
| **EVENTI** | | |
| POST | `/` | Crea nuovo evento (restaurant) |
| GET | `/` | Lista eventi pubblici |
| GET | `/{id}` | Dettaglio evento |
| PUT | `/{id}` | Modifica evento |
| DELETE | `/{id}` | Elimina evento |
| PUT | `/{id}/publish` | Pubblica evento (draft â†’ published) |
| PUT | `/{id}/cancel` | Annulla evento |
| GET | `/restaurant/{restaurantId}` | Eventi di un ristorante |
| GET | `/upcoming` | Prossimi eventi (seguiti + suggeriti) |
| GET | `/nearby` | Eventi vicini (geo-based) |
| GET | `/search?q=&date=&category=` | Cerca eventi |
| **RSVP** | | |
| POST | `/{id}/rsvp` | Partecipa a evento |
| PUT | `/{id}/rsvp` | Modifica RSVP (es. numero ospiti) |
| DELETE | `/{id}/rsvp` | Annulla partecipazione |
| GET | `/{id}/rsvp` | Mio status RSVP |
| GET | `/{id}/attendees` | Lista partecipanti (solo organizer) |
| **MEDIA** | | |
| POST | `/{id}/media` | Upload media evento |
| GET | `/{id}/media` | Lista media evento |
| DELETE | `/{id}/media/{mediaId}` | Elimina media |

### Media API (`/api/v1/media`)

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/upload` | Upload file (image/video) |
| GET | `/{id}` | Get media info |
| GET | `/{id}/thumbnail` | Get thumbnail |
| GET | `/{id}/stream` | Stream video |
| DELETE | `/{id}` | Elimina media |

---

## ðŸš€ Implementation Roadmap

### Phase 1: Core Chat (Week 1-2)
- [ ] Entities: ChatConversation, ChatParticipant, ChatMessage
- [ ] DAOs + Repository layer
- [ ] ChatService basic CRUD
- [ ] REST API endpoints
- [ ] WebSocket integration for real-time

### Phase 2: Group Chat (Week 3)
- [ ] Group conversation logic
- [ ] Add/remove participants
- [ ] Read tracking per participant
- [ ] Typing indicators

### Phase 3: Support System (Week 4-5)
- [ ] SupportTicket entities
- [ ] Ticket workflow (status machine)
- [ ] Agent assignment
- [ ] Escalation logic

### Phase 4: Bot Integration (Week 6-7)
- [ ] FAQ database setup
- [ ] Keyword matching engine
- [ ] Bot response generation
- [ ] Confidence scoring
- [ ] Auto-escalation

### Phase 5: Social Core (Week 8-10)
- [ ] Entities: SocialPost, SocialStory, SocialComment, SocialLike
- [ ] Media upload service (S3/MinIO integration)
- [ ] Follow system (Follow entity)
- [ ] SocialService CRUD operations
- [ ] SocialOrchestrator for notifications
- [ ] Feed algorithm (chronological + relevance)
- [ ] REST API endpoints

### Phase 6: Social Features (Week 11-12)
- [ ] Story system (24h expiry, view tracking)
- [ ] User mentions (@username)
- [ ] Restaurant tagging
- [ ] Reservation linking (auto-prompt post-reservation)
- [ ] Content moderation (basic filters)
- [ ] Discovery algorithms (trending, nearby)

### Phase 7: Restaurant Events (Week 13-14)
- [ ] Entities: RestaurantEvent, EventRSVP, EventMedia
- [ ] Event workflow (draft â†’ published â†’ completed/cancelled)
- [ ] RSVP system with capacity management
- [ ] Auto-reservation creation on RSVP
- [ ] EventOrchestrator for notifications
- [ ] Event reminders (scheduled jobs)
- [ ] REST API endpoints

### Phase 8: Integration & Polish (Week 15-16)
- [ ] Audit integration for all new systems
- [ ] Performance optimization (caching, indexing)
- [ ] Notification preferences granularity
- [ ] Search across all content types
- [ ] Analytics dashboard (engagement metrics)
- [ ] Admin moderation tools
- [ ] Load testing & stress testing

---

## ðŸ“Š Estimated Metrics

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PROJECT COMPLEXITY ESTIMATE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  NEW ENTITIES:                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â”‚
â”‚  Chat System:     4 entities (Conversation, Participant, Message, Att.) â”‚
â”‚  Support System:  4 entities (Ticket, Message, FAQ, BotConfig)          â”‚
â”‚  Social System:   8 entities (Post, Story, Comment, Like, Follow, etc.) â”‚
â”‚  Events System:   3 entities (Event, RSVP, EventMedia)                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  TOTAL:          19 new entities                                        â”‚
â”‚                                                                         â”‚
â”‚  NEW SERVICES:                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â”‚
â”‚  ChatService, SupportService, SocialService, EventService               â”‚
â”‚  MediaService, FeedService, DiscoveryService, ModerationService         â”‚
â”‚  TOTAL: 8 new services                                                  â”‚
â”‚                                                                         â”‚
â”‚  NEW ORCHESTRATORS:                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                     â”‚
â”‚  ChatOrchestrator, SocialOrchestrator                                   â”‚
â”‚  TOTAL: 2 new orchestrators                                             â”‚
â”‚                                                                         â”‚
â”‚  NEW EVENT TYPES:                                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                       â”‚
â”‚  Chat: 10, Support: 12, Social: 17, Events: 10                          â”‚
â”‚  TOTAL: ~49 new EventType values                                        â”‚
â”‚                                                                         â”‚
â”‚  API ENDPOINTS:                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                         â”‚
â”‚  Chat: 12, Support: 10, Social: 32, Events: 18, Media: 5                â”‚
â”‚  TOTAL: ~77 new REST endpoints                                          â”‚
â”‚                                                                         â”‚
â”‚  ESTIMATED EFFORT: 16 weeks (4 months)                                  â”‚
â”‚  TEAM SIZE RECOMMENDED: 2-3 developers                                  â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“‹ Next Steps

### Immediate Actions
1. âœ… Design document (questo file)
2. ðŸ”² Review con team
3. ðŸ”² Setup MinIO/S3 per media storage
4. ðŸ”² Creare migration script DB

### Chat & Support (Phase 1-4)
5. ðŸ”² Creare entitÃ  JPA Chat
6. ðŸ”² Creare DAOs Chat
7. ðŸ”² Implementare ChatService
8. ðŸ”² Creare entitÃ  JPA Support
9. ðŸ”² Implementare SupportService
10. ðŸ”² Implementare Bot system

### Social & Events (Phase 5-7)
11. ðŸ”² Creare entitÃ  JPA Social
12. ðŸ”² Implementare MediaService
13. ðŸ”² Implementare SocialService
14. ðŸ”² Creare entitÃ  JPA Events
15. ðŸ”² Implementare EventService
16. ðŸ”² Creare SocialOrchestrator

### Integration (Phase 8)
17. ðŸ”² Aggiungere EventType all'enum (~49 nuovi)
18. ðŸ”² Creare ChatOrchestrator
19. ðŸ”² REST API tutti i moduli
20. ðŸ”² WebSocket handlers
21. ðŸ”² Test E2E
22. ðŸ”² Performance tuning

---

## ðŸ“ Changelog

| Version | Date | Changes |
|---------|------|---------|
| 1.0 | 2025-12-01 | Initial design: Chat + Support systems |
| 2.0 | 2025-12-01 | Added: Social Food Feed, Restaurant Events, Media management |
| 2.1 | 2025-12-01 | Added: Social/Events API endpoints, expanded roadmap (16 weeks), metrics |
| 3.0 | 2025-12-01 | **ðŸ†• MAJOR**: Added complete RabbitMQ + WebSocket routing architecture |

### v3.0 Changes Detail:
- Added **6 new RabbitMQ queues** for Chat/Social:
  - `notification.chat.direct` - 1:1 messages
  - `notification.chat.group` - Group messages
  - `notification.chat.support` - Support tickets
  - `notification.chat.reservation` - Reservation chats
  - `notification.social.feed` - Posts, likes, comments
  - `notification.social.events` - Restaurant events, RSVP
- Added **ChatOrchestrator** with full disaggregation logic
- Added **SocialOrchestrator** with event-specific handlers
- Added **WebSocket destination mapping** for all new content types
- Updated **EventOutboxOrchestrator** routing for CHAT_*, SUPPORT_*, SOCIAL_*, EVENT_*
- Added **WebSocketDestinationValidator** extensions for chat/social security
- Added **Listener examples** for each queue type
- Added **Routing Table** showing Event â†’ Queue â†’ Orchestrator â†’ Destination

---

*Documento generato: 1 Dicembre 2025*
*Versione: 3.0*
