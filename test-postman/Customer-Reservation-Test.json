{
  "info": {
    "_postman_id": "customer-reservation-test",
    "name": "Customer Reservation Test",
    "description": "Test per il login e creazione di una prenotazione",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "üîê Step 1: Customer Login",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "console.log('\\nüîê CUSTOMER LOGIN');",
              "console.log('Response code:', pm.response.code);",
              "console.log('Response body:', pm.response.text());",
              "if (pm.response.code === 200 || pm.response.code === 201) {",
              "    try {",
              "        var jsonData = pm.response.json();",
              "        var token = jsonData.jwt;",
              "        pm.environment.set('customerToken', token);",
              "        pm.globals.set('customerToken', token);",
              "        console.log('‚úÖ Token saved:', token.substring(0, 50) + '...');",
              "    } catch(e) {",
              "        console.log('‚ùå Error parsing response:', e);",
              "    }",
              "} else {",
              "    console.log('‚ùå Login failed with code:', pm.response.code);",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"username\": \"giulia.bianchi@example.com\",\n  \"password\": \"CustomerPass123!\",\n  \"rememberMe\": true\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/customer/auth/login",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "customer",
            "auth",
            "login"
          ]
        }
      }
    },
    {
      "name": "üìÖ Step 2: Create Reservation",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "console.log('\\nüìÖ CREATING RESERVATION');",
              "if (pm.response.code === 200 || pm.response.code === 201) {",
              "    var jsonData = pm.response.json();",
              "    pm.environment.set('reservationId', jsonData.id);",
              "    console.log('‚úÖ Reservation created successfully');",
              "    console.log('Reservation ID:', jsonData.id);",
              "    console.log('Status:', jsonData.status);",
              "} else {",
              "    console.log('‚ùå Reservation creation failed:', pm.response.text());",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{customerToken}}"
          },
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"userName\": \"Giulia Bianchi\",\n  \"idSlot\": 252,\n  \"pax\": 2,\n  \"kids\": 0,\n  \"notes\": \"Tavolo vicino alla finestra\",\n  \"reservationDay\": \"2025-11-24\",\n  \"restaurantId\": 3\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/customer/reservation/ask",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "customer",
            "reservation",
            "ask"
          ]
        }
      }
    },
    {
      "name": "üìã Step 3: Get Customer Reservations",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "console.log('\\nüìã FETCHING CUSTOMER RESERVATIONS');",
              "if (pm.response.code === 200) {",
              "    var jsonData = pm.response.json();",
              "    console.log('‚úÖ Reservations retrieved successfully');",
              "    console.log('Total reservations:', jsonData.length);",
              "    jsonData.forEach((res, index) => {",
              "        console.log(`Reservation ${index + 1}:`, res.id, '-', res.status);",
              "    });",
              "} else {",
              "    console.log('‚ùå Failed to fetch reservations:', pm.response.text());",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{customerToken}}"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/customer/reservation/reservations",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "customer",
            "reservation",
            "reservations"
          ]
        }
      }
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "https://api.greedys.it",
      "type": "string"
    },
    {
      "key": "customerToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "refreshToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "reservationId",
      "value": "",
      "type": "string"
    }
  ]
}
