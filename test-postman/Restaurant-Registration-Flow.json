{
	"info": {
		"_postman_id": "restaurant-registration-flow",
		"name": "Greedy's Restaurant Registration & Enablement Flow",
		"description": "Complete workflow for registering a new restaurant (test@test.it) and enabling it through admin approval",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Step 1: Register New Restaurant (test@test.it)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"// === STEP 1: REGISTER NEW RESTAURANT ===",
							"console.log('\\nğŸ“‹ STEP 1: REGISTER NEW RESTAURANT');",
							"console.log('='.repeat(60));",
							"",
							"pm.test(\"âœ… Status code is 201 or 200\", function () {",
							"    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
							"});",
							"",
							"pm.test(\"âœ… Restaurant registration successful\", function () {",
							"    var jsonData = pm.response.json();",
							"    console.log('ğŸ“Š Response:', JSON.stringify(jsonData, null, 2));",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.eql(true);",
							"    pm.expect(jsonData).to.have.property('message');",
							"});",
							"",
							"pm.test(\"âœ… Restaurant data returned with ID\", function () {",
							"    var jsonData = pm.response.json();",
							"    pm.expect(jsonData.data).to.have.property('id');",
							"    ",
							"    // Save restaurant ID for next steps",
							"    pm.environment.set('newTestRestaurantId', jsonData.data.id);",
							"    console.log('ğŸ’¾ Saved newTestRestaurantId:', jsonData.data.id);",
							"    ",
							"    // Save user/owner ID if available",
							"    if (jsonData.data.userId) {",
							"        pm.environment.set('newTestRUserId', jsonData.data.userId);",
							"        console.log('ğŸ’¾ Saved newTestRUserId:', jsonData.data.userId);",
							"    }",
							"});",
							"",
							"pm.test(\"âœ… Email is test@test.it\", function () {",
							"    var jsonData = pm.response.json();",
							"    if (jsonData.data && jsonData.data.email) {",
							"        pm.expect(jsonData.data.email).to.eql('test@test.it');",
							"    }",
							"});",
							"",
							"// Store status for debugging",
							"console.log('\\nâœ¨ STEP 1 COMPLETED: Restaurant registered successfully');",
							"console.log('Next: Proceed to STEP 2 - Admin Login');"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"name\": \"Test Restaurant\",\n    \"email\": \"test@test.it\",\n    \"phoneNumber\": \"+39 06 1234 5678\",\n    \"address\": \"Via del Test 1\",\n    \"city\": \"Roma\",\n    \"post_code\": \"00100\",\n    \"vatNumber\": \"IT12345678901\",\n    \"ownerName\": \"Test\",\n    \"ownerSurname\": \"Owner\",\n    \"description\": \"Test Restaurant per il flusso di registrazione\",\n    \"priceLevel\": \"$$\",\n    \"password\": \"TestPass123!\",\n    \"matchingPassword\": \"TestPass123!\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/restaurant/register/new",
					"host": ["{{baseUrl}}"],
					"path": ["restaurant", "register", "new"]
				}
			},
			"description": "ğŸ”§ **Step 1: Register New Restaurant**\n\n- Crea un nuovo ristorante con email `test@test.it`\n- Salva il `newTestRestaurantId` per i passi successivi\n- Salva il `newTestRUserId` (se disponibile)\n\n**Status**: 201/200 Created"
		},
		{
			"name": "Step 2: Admin Login",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"// === STEP 2: ADMIN LOGIN ===",
							"console.log('\\nğŸ“‹ STEP 2: ADMIN LOGIN');",
							"console.log('='.repeat(60));",
							"",
							"pm.test(\"âœ… Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"âœ… JWT token received from admin login\", function () {",
							"    var jsonData = pm.response.json();",
							"    console.log('ğŸ“Š Admin Login Response:', JSON.stringify(jsonData, null, 2));",
							"    ",
							"    pm.expect(jsonData.success).to.eql(true);",
							"    pm.expect(jsonData.data).to.have.property('jwt');",
							"    pm.expect(jsonData.data).to.have.property('refreshToken');",
							"    ",
							"    // Store admin token for subsequent admin requests",
							"    pm.environment.set('testAdminToken', jsonData.data.jwt);",
							"    console.log('ğŸ’¾ Saved testAdminToken:', jsonData.data.jwt.substring(0, 50) + '...');",
							"    ",
							"    // Store refresh token",
							"    if (jsonData.data.refreshToken) {",
							"        pm.environment.set('testAdminRefreshToken', jsonData.data.refreshToken);",
							"    }",
							"});",
							"",
							"pm.test(\"âœ… Admin user data returned\", function () {",
							"    var jsonData = pm.response.json();",
							"    pm.expect(jsonData.data).to.have.property('user');",
							"    pm.expect(jsonData.data.user).to.have.property('id');",
							"    ",
							"    // Save admin ID",
							"    pm.environment.set('testAdminId', jsonData.data.user.id);",
							"    console.log('ğŸ’¾ Saved testAdminId:', jsonData.data.user.id);",
							"});",
							"",
							"console.log('\\nâœ¨ STEP 2 COMPLETED: Admin logged in successfully');",
							"console.log('Next: Proceed to STEP 3 - Find Restaurant User by Email');"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"username\": \"{{adminEmail}}\",\n    \"password\": \"{{adminPassword}}\",\n    \"rememberMe\": true\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/admin/auth/login",
					"host": ["{{baseUrl}}"],
					"path": ["admin", "auth", "login"]
				}
			},
			"description": "ğŸ” **Step 2: Admin Login**\n\n- Login con le credenziali admin dall'environment\n- Estrae e salva il `testAdminToken`\n- Estrae e salva il `testAdminId`\n\n**Credenziali usate:**\n- Email: `{{adminEmail}}`\n- Password: `{{adminPassword}}`\n\n**Status**: 200 OK"
		},
		{
			"name": "Step 3: Get Restaurant User by Email (test@test.it)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"// === STEP 3: GET RESTAURANT USER BY EMAIL ===",
							"console.log('\\nğŸ“‹ STEP 3: GET RESTAURANT USER BY EMAIL');",
							"console.log('='.repeat(60));",
							"",
							"pm.test(\"âœ… Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"âœ… Restaurant user found with email test@test.it\", function () {",
							"    var jsonData = pm.response.json();",
							"    console.log('ğŸ“Š User Details:', JSON.stringify(jsonData.data, null, 2));",
							"    ",
							"    pm.expect(jsonData.success).to.eql(true);",
							"    pm.expect(jsonData.data).to.have.property('id');",
							"    pm.expect(jsonData.data).to.have.property('username');",
							"    pm.expect(jsonData.data).to.have.property('restaurantId');",
							"});",
							"",
							"pm.test(\"âœ… Store Restaurant User ID for enablement\", function () {",
							"    var jsonData = pm.response.json();",
							"    ",
							"    // Store the restaurant user ID",
							"    pm.environment.set('testRUserId', jsonData.data.id);",
							"    pm.environment.set('testRestaurantId', jsonData.data.restaurantId);",
							"    ",
							"    console.log('ğŸ’¾ Saved testRUserId:', jsonData.data.id);",
							"    console.log('ğŸ’¾ Saved testRestaurantId:', jsonData.data.restaurantId);",
							"    console.log('ğŸ“§ User email:', jsonData.data.username);",
							"});",
							"",
							"console.log('\\nâœ¨ STEP 3 COMPLETED: Found restaurant user');",
							"console.log('Next: Proceed to STEP 4 - Enable Restaurant User');"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{testAdminToken}}"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/admin/restaurant/user/by-email/test@test.it",
					"host": ["{{baseUrl}}"],
					"path": ["admin", "restaurant", "user", "by-email", "test@test.it"]
				}
			},
			"description": "ğŸ” **Step 3: Get Restaurant User by Email**\n\n- Ricerca l'utente ristorante con email `test@test.it`\n- Salva il `testRUserId` per l'abilitazione\n- Salva il `testRestaurantId` del ristorante\n\n**Status**: 200 OK"
		},
		{
			"name": "Step 4: Enable Restaurant User (test@test.it)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"// === STEP 4: ENABLE RESTAURANT USER ===",
							"console.log('\\nğŸ“‹ STEP 4: ENABLE RESTAURANT USER');",
							"console.log('='.repeat(60));",
							"",
							"pm.test(\"âœ… Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"âœ… Restaurant user enabled successfully\", function () {",
							"    var jsonData = pm.response.json();",
							"    console.log('ğŸ“Š Enable Response:', JSON.stringify(jsonData, null, 2));",
							"    ",
							"    pm.expect(jsonData.success).to.eql(true);",
							"    pm.expect(jsonData.message).to.include('User enabled successfully');",
							"});",
							"",
							"console.log('\\nâœ¨ STEP 4 COMPLETED: Restaurant User enabled');",
							"console.log('Next: Proceed to STEP 5 - Enable Restaurant');"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{testAdminToken}}"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/admin/restaurant/user/enable?email=test@test.it",
					"host": ["{{baseUrl}}"],
					"path": ["admin", "restaurant", "user", "enable"],
					"query": [
						{
							"key": "email",
							"value": "test@test.it"
						}
					]
				}
			},
			"description": "âœ… **Step 4: Enable Restaurant User**\n\n- Abilita l'utente ristorante con email `test@test.it`\n- L'admin autorizza l'accesso del gestore del ristorante\n\n**Status**: 200 OK"
		},
		{
			"name": "Step 5: Enable Restaurant",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"// === STEP 5: ENABLE RESTAURANT ===",
							"console.log('\\nğŸ“‹ STEP 5: ENABLE RESTAURANT');",
							"console.log('='.repeat(60));",
							"",
							"pm.test(\"âœ… Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"âœ… Restaurant enabled successfully\", function () {",
							"    var jsonData = pm.response.json();",
							"    console.log('ğŸ“Š Enable Restaurant Response:', JSON.stringify(jsonData, null, 2));",
							"    ",
							"    pm.expect(jsonData.success).to.eql(true);",
							"    pm.expect(jsonData.message).to.include('successfully');",
							"});",
							"",
							"console.log('\\nâœ¨ STEP 5 COMPLETED: Restaurant enabled');",
							"console.log('Next: Proceed to STEP 6 - Restaurant User Login (verification)');"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{testAdminToken}}"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/admin/restaurant/{{testRestaurantId}}/enable_restaurant",
					"host": ["{{baseUrl}}"],
					"path": ["admin", "restaurant", "{{testRestaurantId}}", "enable_restaurant"]
				}
			},
			"description": "âœ… **Step 5: Enable Restaurant**\n\n- L'admin abilita il ristorante con ID `{{testRestaurantId}}`\n- Rende il ristorante visibile e operativo nel sistema\n\n**Status**: 200 OK"
		},
		{
			"name": "Step 6: Restaurant User Login (Verification)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"// === STEP 6: RESTAURANT USER LOGIN (VERIFICATION) ===",
							"console.log('\\nğŸ“‹ STEP 6: RESTAURANT USER LOGIN - VERIFICATION');",
							"console.log('='.repeat(60));",
							"",
							"pm.test(\"âœ… Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"âœ… JWT token received for restaurant user\", function () {",
							"    var jsonData = pm.response.json();",
							"    console.log('ğŸ“Š Login Response:', JSON.stringify(jsonData, null, 2));",
							"    ",
							"    pm.expect(jsonData.success).to.eql(true);",
							"    pm.expect(jsonData.data).to.have.property('jwt');",
							"    ",
							"    // Store restaurant token",
							"    var token = jsonData.data.jwt || jsonData.data.accessToken;",
							"    pm.environment.set('testRestaurantToken', token);",
							"    console.log('ğŸ’¾ Saved testRestaurantToken:', token.substring(0, 50) + '...');",
							"});",
							"",
							"pm.test(\"âœ… User and restaurant info returned\", function () {",
							"    var jsonData = pm.response.json();",
							"    if (jsonData.data.user) {",
							"        console.log('ğŸ‘¤ User:', jsonData.data.user.username);",
							"        console.log('ğŸª Restaurant ID:', jsonData.data.user.restaurantId);",
							"    }",
							"});",
							"",
							"console.log('\\nğŸ‰ COMPLETE: Restaurant Flow Successful!');",
							"console.log('â•'.repeat(60));",
							"console.log('âœ… Ristorante registrato: test@test.it');",
							"console.log('âœ… Admin ha abilitato l\\'utente ristorante');",
							"console.log('âœ… Admin ha abilitato il ristorante');",
							"console.log('âœ… Utente ristorante puÃ² ora fare login');",
							"console.log('â•'.repeat(60));"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"username\": \"test@test.it\",\n    \"password\": \"TestPass123!\",\n    \"rememberMe\": true\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/restaurant/user/auth/login",
					"host": ["{{baseUrl}}"],
					"path": ["restaurant", "user", "auth", "login"]
				}
			},
			"description": "ğŸ” **Step 6: Restaurant User Login (Verification)**\n\n- Verifica che l'utente ristorante puÃ² fare login\n- Conferma che il flusso di abilitazione Ã¨ completo\n\n**Credenziali:**\n- Email: `test@test.it`\n- Password: `TestPass123!`\n\n**Status**: 200 OK"
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Pre-request validation",
					"const authHeader = pm.request.headers.get('Authorization');",
					"if (authHeader && authHeader.includes('Bearer')) {",
					"    console.log('ğŸ” Authenticated request with token');",
					"}"
				]
			}
		}
	]
}
