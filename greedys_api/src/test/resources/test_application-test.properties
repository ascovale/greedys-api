// Sample integration test that would use your application-test.properties

@SpringBootTest
@TestPropertySource(locations = "classpath:application-test.properties")
@AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.NONE)
@Transactional
class UserServiceIntegrationTest {

    @Autowired
    private UserService userService;
    
    @Autowired
    private UserRepository userRepository;
    
    @MockBean
    private EmailService emailService; // Mock external dependency
    
    @Test
    void shouldCreateUserSuccessfully() {
        // Given
        User user = new User("john@example.com", "password");
        
        // When
        User savedUser = userService.createUser(user);
        
        // Then
        assertThat(savedUser.getId()).isNotNull();
        assertThat(userRepository.findById(savedUser.getId())).isPresent();
        verify(emailService).sendWelcomeEmail(user.getEmail());
    }
}

@WebMvcTest(UserController.class)
@TestPropertySource(locations = "classpath:application-test.properties")
class UserControllerTest {

    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private UserService userService; // Mock service layer
    
    @MockBean
    private JwtUtil jwtUtil; // Mock JWT utility
    
    @Test
    void shouldReturnUserWhenValidRequest() throws Exception {
        // Given
        User user = new User("john@example.com", "John");
        when(userService.findById(1L)).thenReturn(user);
        when(jwtUtil.validateToken(anyString())).thenReturn(true);
        
        // When & Then
        mockMvc.perform(get("/api/users/1")
                .header("Authorization", "Bearer test-token"))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.email").value("john@example.com"));
    }
}

@DataJpaTest
@TestPropertySource(locations = "classpath:application-test.properties")
class UserRepositoryTest {

    @Autowired
    private TestEntityManager entityManager;
    
    @Autowired
    private UserRepository userRepository;
    
    @Test
    void shouldFindUserByEmail() {
        // Given
        User user = new User("test@example.com", "password");
        entityManager.persistAndFlush(user);
        
        // When
        Optional<User> found = userRepository.findByEmail("test@example.com");
        
        // Then
        assertThat(found).isPresent();
        assertThat(found.get().getEmail()).isEqualTo("test@example.com");
    }
}